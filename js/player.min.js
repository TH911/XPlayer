function responsiveDesign(n){var o=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,e=document.getElementById("playlist_button"),a=document.getElementById("songimg"),i=document.getElementById("player"),r=document.getElementById("playlist_ol"),c=document.getElementById("playlist"),d=document.getElementById("header"),u=document.getElementById("lyricWrapper"),s=(u.style.height=t-130+"px",document.getElementById("controls")),p=document.getElementById("search-container"),l=document.getElementById("spectrum");o<t||o<800?(s.style.position="fixed",s.style.top="0px",s.style.height="200px",d.style.display="none",e.style.display="block",e.style.width=Math.floor(.4*o)+"px",a.style.display="none",n&&(c.style.display="none"),c.style.width=Math.floor(.8*o)+"px",c.style.height=t-140+"px",r.style.height=c.style.height,c.style.backgroundColor="#1b2426",i.style.width=Math.floor(.9*o)+"px",i.style.opacity=1,i.style.bottom="0px",p.style.display="none",p.style.width=c.style.width,p.style.right="auto",p.style.left=0,p.style.top="60px","block"!=c.style.display&&(document.getElementById("button_search-container").style.display="block"),document.getElementById("button_search-container").style.width=e.style.width,u.style.width="90%"):(s.style.position="relative",s.style.height="77px",d.style.display="block",a.style.display="block",c.style.display="block",e.style.display="none",c.style.height=t-80+"px",c.style.width=Math.floor(.24*o)+"px",c.style.backgroundColor="#32323280",r.style.height=c.style.height,i.style.width=Math.floor(.5*o)+"px",a.style.width=c.style.width,i.style.bottom="5px",i.style.opacity=.6,document.getElementById("songinfo_name").style.fontSize=Math.floor(Math.floor(.24*o)/15)+"px",document.getElementById("songinfo_artist").style.fontSize=Math.floor(Math.floor(.24*o)/20)+"px",document.getElementById("songinfo_album").style.fontSize=Math.floor(Math.floor(.24*o)/20)+"px",a.style.top=Math.floor((t-Math.floor(.24*o)-Math.floor(Math.floor(.24*o)/15)-Math.floor(Math.floor(.24*o)/20)-Math.floor(Math.floor(.24*o)/20))/2)+"px",p.style.display="block",p.style.width=c.style.width,p.style.left="auto",p.style.right="20px",p.style.top="20px",document.getElementById("button_search-container").style.display="none",u.style.width="50%"),l.style.width=u.style.width}function playlist_hide(){var n,o,t,e=document.getElementById("playlist"),a=document.getElementById("button_search-container");"none"==e.style.display?(e.style.display="block",a.style.display="none",document.getElementById("search-container").style.display="none",document.getElementById("controls").style.display="none",n=document.getElementById("playlist_ol"),o=document.getElementById("playlist-"+PLAYER.currentIndex),t=e.style.height.split("px")[0],n.scrollTop=Math.max(0,o.offsetTop-Math.floor(parseInt(t)/2))):(e.style.display="none",a.style.display="block",document.getElementById("controls").style.display="block")}function initAudioEvent(t){var e=document.getElementsByTagName("audio")[t],n=document.getElementById("audioPlayer"+t),a=(e.addEventListener("loadedmetadata",function(){var n=PLAYER.duration;document.getElementById("audio-length-total").textContent=transTime(Math.ceil(n))}),e.addEventListener("timeupdate",function(){updateProgress(e,t)},!1),e.addEventListener("pause",function(){n.src="data:image/png;base64,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"},!1),e.addEventListener("play",function(){n.src="data:image/png;base64,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"},!1),n.addEventListener("click",function(){e.paused?e.play():e.pause()},!1),window.addEventListener("keydown",function(n){" "==n.key&&(e.paused?e.play():e.pause())},!1),document.getElementById("progressBarBg"+t));a.addEventListener("mousedown",function(n){var o;e.paused&&0==e.currentTime||(o=parseFloat(window.getComputedStyle(a,null).width.replace("px","")),n=n.offsetX/o,e.currentTime=PLAYER.duration*n,updateProgress(e,t))},!1),dragProgressDotEvent(e,t)}function dragProgressDotEvent(t,e){var o=document.getElementById("progressDot"+e),a={oriOffestLeft:0,oriX:0,maxLeft:0,maxRight:0},i=!1;function n(n){t.paused&&0==t.currentTime||(i=!0,a.oriOffestLeft=o.offsetLeft,a.oriX=(n.touches?n.touches[0]:n).clientX,a.maxLeft=a.oriOffestLeft,a.maxRight=document.getElementById("progressBarBg"+e).offsetWidth-a.oriOffestLeft,n&&n.preventDefault?n.preventDefault():n.returnValue=!1,n&&n.stopPropagation?n.stopPropagation():window.event.cancelBubble=!0)}function r(n){var o;i&&((n=(n.touches?n.touches[0]:n).clientX-a.oriX)>a.maxRight?n=a.maxRight:n<-a.maxLeft&&(n=-a.maxLeft),o=document.getElementById("progressBarBg"+e),o=parseFloat(window.getComputedStyle(o,null).width.replace("px","")),n=(a.oriOffestLeft+n)/o,t.currentTime=PLAYER.duration*n,updateProgress(t,e))}function c(){i=!1}o.addEventListener("mousedown",n,!1),o.addEventListener("touchstart",n,!1),document.addEventListener("mousemove",r,!1),document.addEventListener("touchmove",r,!1),document.addEventListener("mouseup",c,!1),document.addEventListener("touchend",c,!1)}function updateProgress(n,o){var t=n.currentTime/PLAYER.duration;document.getElementById("progressBar"+o).style.width=100*t+"%",document.getElementById("progressDot"+o).style.left=100*t+"%",document.getElementById("audioCurTime"+o).innerText=transTime(n.currentTime)}function transTime(n){var o=parseInt(n/3600),t=(n%=3600,parseInt(n/60)),n=parseInt(n%60);return formatTime(0<o?o+":"+t+":"+n:t+":"+n)}function formatTime(n){for(var o="",t=n.split(":"),e=0;e<t.length-1;e++)o=o+(1==t[e].length?"0"+t[e]:t[e])+":";return o+=1==t[e].length?"0"+t[e]:t[e]}responsiveDesign(!0),window.addEventListener("resize",function(){responsiveDesign(!0)}),document.addEventListener("DOMContentLoaded",function(){for(var n=document.querySelector(".audio-right"),n=window.getComputedStyle(n,null).width,o=(document.querySelector(".audio-right p").style.maxWidth=n,document.getElementsByTagName("audio")),t=0;t<o.length;t++)initAudioEvent(t)},!1);const searchBox=document.getElementById("search-box"),searchResults=document.getElementById("search-results");async function loadData(){try{const n=await fetch("json/content.json");return(await n.json()).data}catch(n){console.error("failed to loading the search box of songs:",n)}}async function searchSongs(n){if(n){const o=await loadData(),t=n.toLowerCase(),e=o.filter(n=>n.song_name.toLowerCase().includes(t)||n.artist.toLowerCase().includes(t)||n.lrc_name.toLowerCase().includes(t));searchResults.innerHTML=e.map(n=>`<li id='search-songs-${n.lrc_name}'>
            <strong>${n.song_name}</strong> - ${n.artist}
        </li>`).join("")}else searchResults.innerHTML=""}function search_hide(){var n=document.getElementById("search-container");"none"==n.style.display?(n.style.display="block",document.getElementById("controls").style.display="none"):(n.style.display="none",document.getElementById("controls").style.display="block")}function menu_color_change(n,o){n.style.color=2==o?"#999":"#fff",localStorage.getItem("player_mode")==n.id.substring(5)&&(n.style.color="#fff"),localStorage.getItem("player_font")==n.id.substring(10)&&(n.style.color="#fff")}function player_opacity(n){var o=document.getElementById("player");o.style.opacity=1==n?.6:1}function playmode_change(n){null!=localStorage.getItem("player_mode")&&(document.getElementById("menu_"+localStorage.getItem("player_mode")).style.color="#999"),localStorage.setItem("player_mode",n),document.getElementById("menu_"+n).style.color="#fff"}function font_change(n){var o=localStorage.getItem("player_font"),t=(null!=o&&(document.getElementById("menu_font_"+o).style.color="#999"),localStorage.setItem("player_font",n),document.getElementById("menu_font_"+n).style.color="#fff",document.getElementById("lyricWrapper"));switch(t.style.fontFamily=n){case"fordefault":case"youyuan":t.style.fontSize="16px";break;default:t.style.fontSize="18px"}}function hide_font(){var n=document.getElementById("menu-font");"none"==n.style.display?n.style.display="block":n.style.display="none"}function hide_playmode(){var n=document.getElementById("menu-playmode");"none"==n.style.display?n.style.display="block":n.style.display="none"}function mediaSessionAPI(n,o,t){return"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:o,artist:t,artwork:[{src:document.getElementById("cover_img").src}]}),navigator.mediaSession.setActionHandler("seekbackward",function(){var n=document.getElementById("audio");n.currentTime-=Math.min(10,n.currentTime)}),navigator.mediaSession.setActionHandler("seekforward",function(){var n=document.getElementById("audio");n.currentTime+=Math.min(10,PLAYER.duration-n.currentTime)}),navigator.mediaSession.setActionHandler("previoustrack",function(){n.playPrev(n)}),navigator.mediaSession.setActionHandler("nexttrack",function(){n.playNext(n)}),navigator.mediaSession.setActionHandler("play",function(){document.getElementById("audio").play()}),navigator.mediaSession.setActionHandler("pause",function(){document.getElementById("audio").pause()}),!0)}searchBox.addEventListener("input",n=>{searchSongs(n.target.value)}),searchResults.addEventListener("click",n=>{const o=n.target;"li"===o.tagName.toLowerCase()&&(document.getElementById("search-box").value="",document.getElementById("search-results").innerHTML="",responsiveDesign(),PLAYER.playNum(PLAYER,parseInt(o.id.substring(13))-1))}),document.addEventListener("keydown",function(n){" "===n.key&&n.preventDefault()}),$(document).ready(function(){$(".menu-title").click(function(){$(this).siblings(".menu-content").toggleClass("show")})});var pipWindow,pipWindowIsOpened=!1;async function pipWindowCreate(n,o){console.log("pipWindow has created."),pipWindow=await window.documentPictureInPicture.requestWindow({width:n,height:o}),pipWindowIsOpened=!0,pipWindow.document.addEventListener("keydown",function(n){"p"==n.key&&(pipWindow.close(),keydownForPipWindow=0)," "==n.key&&(PLAYER.audio.paused?PLAYER.audio.play():PLAYER.audio.pause()),"ArrowUp"==n.code?PLAYER.playPrev(PLAYER):"ArrowDown"==n.code?PLAYER.playNext(PLAYER):"ArrowLeft"==n.code?PLAYER.audio.currentTime-=Math.min(PLAYER.audio.currentTime,10):"ArrowRight"==n.code&&(PLAYER.audio.currentTime+=10)}),pipWindow.addEventListener("beforeunload",function(){keydownForPipWindow=0,pipWindowIsOpened=!1});try{for(var t=0,e=PLAYER.lyric.length;t<=e;t++)if(t==e||PLAYER.audio.currentTime<=PLAYER.lyric[t][0]-.5){0<t&&t--,1<t&&PLAYER.lyric[t][0]==PLAYER.lyric[t-1][0]&&(t-=1);var a=null,i=PLAYER.lyric[t][1];t+1<e&&PLAYER.lyric[t][0]==PLAYER.lyric[t+1][0]&&(a=PLAYER.lyric[t+1][1]),0==i.length&&(i=" "),pipWindowIsOpened&&pipWindowFill(i,a);break}}catch(n){console.log("ERROR:"+n)}}function pipWindowFillTextLength(n){for(var o=0,t=0;t<n.length;t++){for(var e=!1,a=[" ",",",".","<",">",";",":",'"',"'","{","}","[","]","-","_","+","=","!","~","`","@","#","$","%","^","&","*","(",")","|","\\"],i=0;i<a.length;i++)if(n[t]==a[i]){e=!0;break}"a"<=n[t]&&n[t]<="z"||"A"<=n[t]&&n[t]<="Z"||e?o+=.5:o++}return o}async function pipWindowFill(n,o){var t,e=document.createElement("div"),a=(e.id="tool",e.textContent=n,e.style.fontFamily=localStorage.getItem("player_font"),e.style.textShadow="1px 0 0 #000, -1px 0 0 #000, 0 1px 0 #000, 0 -1px 0 #000",e.style.fontWeight="bolder",pipWindowFillTextLength(n));e.style.fontSize=Math.min(Math.floor((pipWindow.innerWidth-40)/a),pipWindow.innerHeight-20)+"px",e.style.color=["#FAFA17","#ff1493","#adff2f","#d731f8"][PLAYER.lyricStyle],pipWindow.document.body.innerHTML="",pipWindow.addEventListener("resize",function(){var n=pipWindow.document.getElementById("tool");n.fontSize=Math.min(Math.floor((pipWindow.innerWidth-40)/n.textContent.length),pipWindow.innerHeight-20)+"px"}),e.style.textAlign="center",e.style.lineHeight=pipWindow.innerHeight-20+"px",null!=o&&(t=pipWindowFillTextLength(o),e.style.fontSize=Math.min(Math.min(Math.floor((pipWindow.innerWidth-40)/a),(pipWindow.innerHeight-20)/2),Math.min(Math.floor((pipWindow.innerWidth-40)/t),pipWindow.innerHeight-20))+"px",e.textContent=n+""+o,a=document.createElement("div"),t=document.createElement("div"),e.style.lineHeight=Math.floor((pipWindow.innerHeight-20)/2)+"px",e.textContent="",a.textContent=n,t.textContent=o,t.style.color="#fff",e.appendChild(a),e.appendChild(t)),pipWindow.document.body.appendChild(e)}var PLAYER,keydownForPipWindow=0,Selected=(document.addEventListener("keydown",function(n){"p"==n.key&&("documentPictureInPicture"in window?2==++keydownForPipWindow?(keydownForPipWindow=0,pipWindow.close()):pipWindowCreate(300,20):console.log("pipWindow isn't supported."))}),window.onload=function(){var n=localStorage.getItem("player_mode"),n=(null==n&&(localStorage.setItem("player_mode","order"),n="order"),playmode_change(n),localStorage.getItem("player_font"));null==n&&(localStorage.setItem("player_font","fordefault"),n="fordefault"),font_change(n),(PLAYER=new Selected).init()},function(){this.audio=document.getElementById("audio"),this.lyricContainer=document.getElementById("lyricContainer"),this.playlist=document.getElementById("playlist"),this.currentIndex=0,this.lyric=null,this.lyricStyle=0,this.last=-1,this.audio_name=[],this.audio_artist=[],this.audio_album=[],this.duration=0,this.audio_duration=[]}),cvs=(Selected.prototype={constructor:Selected,init:function(){this.initialList(this);var n,c=this,o=this.playlist.children[0].children,t=window.location.hash.substring(1),t=1<=t&&t<=o.length?t:0;this.currentIndex=t||Math.floor(Math.random()*o.length)+1,this.currentIndex=this.currentIndex-1,n=(t=o[this.currentIndex]).children[0].getAttribute("data-name"),window.location.hash=window.location.hash||n,this.playlist.addEventListener("click",function(n){var o,t;"a"===n.target.nodeName.toLowerCase()&&(o=c.playlist.children[0].children,o=Array.prototype.indexOf.call(o,n.target.parentNode),t=c.currentIndex,c.currentIndex=o,c.setClass(t,o),t=n.target.getAttribute("data-name"),window.location.hash=t,c.play(t))},!1),this.audio.onended=function(){c.ending(c)},this.audio.onerror=function(n){console.log("audio load error:"+n);n=sessionStorage.getItem("audioErrorCount");null==n&&(n=0),++n<=2?c.play(c.currentIndex+1):c.lyricContainer.textContent="歌曲加载失败,请检查网络或清空缓存并重试"},window.addEventListener("keydown",function(n){var o;"ArrowUp"==n.code?c.playPrev(c):"ArrowDown"==n.code?c.playNext(c):"ArrowLeft"==n.code?(o=this.document.getElementById("audio")).currentTime-=Math.min(o.currentTime,10):"ArrowRight"==n.code&&((o=this.document.getElementById("audio")).currentTime+=10)},!1),document.getElementById("bg_dark").addEventListener("click",function(){document.getElementsByTagName("html")[0].className="colorBg"}),document.getElementById("bg_pic").addEventListener("click",function(){document.getElementsByTagName("html")[0].className="imageBg"});for(var e=o.length-1;0<=e;e--)o[e].className="";t.className="current-song",this.audio.addEventListener("timeupdate",function(n){try{if(!c.lyric)return;for(var o=0,t=c.lyric.length;o<=t;o++){if(o==t||this.currentTime<=c.lyric[o][0]-.5){0<o&&o--,1<o&&c.lyric[o][0]==c.lyric[o-1][0]&&(o-=1),(i=document.getElementById("line-"+o)).className="current-line-"+c.lyricStyle,o!=c.last&&(c.last=o,document.getElementById("lyricWrapper").scrollTop=i.offsetTop);var e=null,a=c.lyric[o][1];o+1<t&&c.lyric[o][0]==c.lyric[o+1][0]&&(e=c.lyric[o+1][1]),0==a.length&&(a=" "),mediaSessionAPI(c,sessionStorage.getItem("audio_name"),a),pipWindowIsOpened&&pipWindowFill(a,e);for(var i,r=o+1;r<t;r++)(i=document.getElementById("line-"+r)).className="";break}try{(i=document.getElementById("line-"+o)).className=""}catch{console.log("error on #"+o)}}}catch(n){console.log("ERROR:"+n)}}),this.play(n)},initialList:function(t){var i=this,e=new XMLHttpRequest;e.open("GET","json/content.json",!1),e.onreadystatechange=function(){var n,o,a;200==e.status&&4==e.readyState&&(a=document.createDocumentFragment(),n=JSON.parse(e.responseText).data,o=t.playlist.getElementsByTagName("ol")[0],a=document.createDocumentFragment(),n.forEach(function(n,o,t){var e=document.createElement("li");(t=document.createElement("a")).href="javascript:void(0)",t.dataset.name=n.lrc_name,t.textContent=n.song_name+" - "+n.artist,i.audio_name[n.lrc_name]=n.song_name,i.audio_artist[n.lrc_name]=n.artist,i.audio_album[n.lrc_name]=n.album,i.audio_duration[n.lrc_name]=n.duration,e.appendChild(t),e.id="playlist-"+o,a.appendChild(e)}),o.appendChild(a))},e.send()},play:function(n,o=-1){console.log("PLAYER.play("+n+(-1!=o?","+o:"")+");");var t,e,a=this;this.lyricContainer.textContent="loading song...",this.audio.src="./music/"+n+".mp3",this.audio.currentTime=0,this.audio.addEventListener("canplay",function(){a.audio.play(),a.getLyric(a.audio.src.replace(".mp3",".lrc"))},{once:!0}),this.audio.play(),-1!=o?this.play(o):(o=document.getElementById("playlist_ol"),t=document.getElementById("playlist-"+PLAYER.currentIndex),e=playlist.style.height.split("px")[0],o.scrollTop=Math.max(0,t.offsetTop-Math.floor(parseInt(e)/2)),songinfo_audio.textContent=this.playlist.getElementsByTagName("li")[n-1].textContent,document.title=songinfo_audio.textContent+" | XPlayer",document.getElementById("cover_img").src="./music/"+n+".webp",document.getElementById("songinfo_name").textContent=this.audio_name[n],document.getElementById("songinfo_artist").textContent="歌手: "+this.audio_artist[n],document.getElementById("songinfo_album").textContent="专辑: "+this.audio_album[n],this.duration=this.audio_duration[n],sessionStorage.setItem("audio_name",this.audio_name[n]),mediaSessionAPI(this,sessionStorage.getItem("audio_name")," "),o=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,this.lyricContainer.style.top=Math.floor(.4*(o-100)),this.lyric=null,this.lyricStyle=Math.floor(4*Math.random()))},getLyric:function(n){var o=this,t=new XMLHttpRequest;t.open("GET",n,!0),t.responseType="text",t.onload=function(){o.lyric=o.parseLyric(t.response),o.appendLyric(o.lyric)},t.onerror=t.onabort=function(n){o.lyricContainer.textContent="歌词加载失败,请检查网络或清空缓存并重试"},this.lyricContainer.textContent="loading lyric...",t.send()},parseLyric:function(n){for(var o=n.split("\n"),i=/\[\d{2}:\d{2}.\d{2}\]/g,r=[],c=this.getOffset(n);!i.test(o[0]);)o=o.slice(1);return 0==o[o.length-1].length&&o.pop(),o.forEach(function(n,o,t){var e=n.match(i),a=n.replace(i,"");e.forEach(function(n,o,t){n=n.slice(1,-1).split(":");r.push([60*parseInt(n[0],10)+parseFloat(n[1])+parseInt(c)/1e3,a])})}),r.sort(function(n,o){return n[0]-o[0]}),r},appendLyric:function(n){var o=this.lyricContainer,i=document.createDocumentFragment(),r=(this.lyricContainer.innerHTML="",this);n.forEach(function(n,o,t){var e=document.createElement("p"),a=document.createElement("span");a.id="line-"+o,a.textContent=n[1],a.style.backgroundClip="text",a.addEventListener("click",function(){r.audio.currentTime=n[0],document.getElementById("lyricWrapper").scrollTop=a.offsetTop}),e.appendChild(a),i.appendChild(e)}),o.appendChild(i)},ending:function(n){this.audio.currentTime=0,pipWindowIsOpened&&pipWindowFill(" ",null);var o="order";switch(null!=localStorage.getItem("player_mode")?o=localStorage.getItem("player_mode"):localStorage.setItem("player_mode",o),o){case"order":n.playNext(n);break;case"reverse":n.playPrev(n);break;case"random":n.playRandom(n);break;case"loop":n.playAgain(n)}},all_played:function(n){for(var o=n.playlist.children[0].children,t=0;t<o.length;t++)if("current-song-played"!=o[t].className&&"current-song"!=o[t].className)return!1;return!0},playNum:function(n,o){var t=this.playlist.children[0].children,e=n.currentIndex;n.currentIndex=o,n.setClass(e,n.currentIndex);o=t[n.currentIndex].children[0].getAttribute("data-name");window.location.hash=o,n.play(o)},playRandom:function(n){var o,t=this.playlist.children[0].children,e=n.currentIndex,a=n.all_played(n);if(a)for(var i=0;i<t.length;i++)t[i].className="";for(;n.currentIndex=Math.floor(Math.random()*this.playlist.children[0].children.length),"current-song-played"==t[n.currentIndex].className||"current-song"==t[n.currentIndex].className;);o=t[n.currentIndex].children[0],n.setClass(a?-1:e,n.currentIndex);a=o.getAttribute("data-name");window.location.hash=a,n.play(a)},playAgain:function(n){n.play(window.location.hash.substring(1))},playNext:function(n){var o=this.playlist.children[0].children,t=n.currentIndex,t=(n.currentIndex===o.length-1?n.currentIndex=0:n.currentIndex+=1,o=o[n.currentIndex].children[0],n.setClass(t,n.currentIndex),o.getAttribute("data-name"));window.location.hash=t,n.play(t)},playPrev:function(n){var o=this.playlist.children[0].children,t=n.currentIndex,t=(0===n.currentIndex?n.currentIndex=o.length-1:--n.currentIndex,o=o[n.currentIndex].children[0],n.setClass(t,n.currentIndex),o.getAttribute("data-name"));window.location.hash=t,n.play(t)},setClass:function(n,o){var t=this.playlist.children[0].children;-1!=n&&(t[n].className="current-song-played"),t[o].className="current-song"},getOffset:function(n){var o=0;try{var t=n.match(/\[offset:\-?\+?\d+\]/g)[0].split(":")[1],o=parseInt(t)}catch(n){o=0}return o}},document.getElementById("spectrum-cvs")),ctx=cvs.getContext("2d"),audio=document.getElementById("audio");let analyser=null,dataArray=new Uint8Array(512);function initAudio(){let n=new AudioContext,o=n.createMediaElementSource(audio);(analyser=n.createAnalyser()).fftSize=512,dataArray=new Uint8Array(analyser.frequencyBinCount),draw(),o.connect(analyser),analyser.connect(n.destination)}function draw(){requestAnimationFrame(draw),ctx.clearRect(0,0,cvs.width,cvs.height),analyser.getByteFrequencyData(dataArray);var o=cvs.width/3;const t=ctx.createLinearGradient(0,0,cvs.width,0);t.addColorStop(0,"#00ffff"),t.addColorStop(1,"#ff1493");for(let n=0;n<o;n++){var e=dataArray[n]/255*cvs.height;drawRoundedRect(3*n,cvs.height-e,3,e,3),ctx.fillStyle=t,ctx.fill()}}function drawRoundedRect(n,o,t,e,a){ctx.beginPath(),ctx.moveTo(n+a,o),ctx.lineTo(n+t-a,o),ctx.arcTo(n+t,o,n+t,o+e,a),ctx.lineTo(n+t,o+e-a),ctx.arcTo(n+t,o+e,n+t-a,o+e,a),ctx.lineTo(n+a,o+e),ctx.arcTo(n,o+e,n,o+e-a,a),ctx.lineTo(n,o+a),ctx.arcTo(n,o,n+a,o,a),ctx.closePath(),ctx.lineWidth=1,ctx.strokeStyle="#000",ctx.stroke()}initAudio(),document.getElementById("audio").addEventListener("pause",function(){ctx.clearRect(0,0,cvs.width,cvs.height)});
function responsiveDesign(t){var o=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,e=document.getElementById("playlist"),a=document.getElementById("search-container");(o<n||o<800)&&(t&&(e.style.display="none"),a.style.display="none")}function playlist_hide(){var t,o,n=document.getElementById("playlist"),e=document.getElementById("button_search-container");"none"==n.style.display?(n.style.display="block",e.style.display="none",document.getElementById("search-container").style.display="none",t=document.getElementById("playlist_ol"),o=document.getElementById("playlist-"+PLAYER.currentIndex),t.scrollTo({top:Math.max(0,o.offsetTop-Math.floor(parseInt(n.clientHeight)/2)),behavior:"smooth"})):(n.style.display="none",e.style.display="block")}function initAudioEvent(n){var e=document.getElementsByTagName("audio")[n],t=document.getElementById("audioPlayer"+n),a=(e.addEventListener("loadedmetadata",function(){var t=PLAYER.duration;document.getElementById("audio-length-total").textContent=transTime(Math.ceil(t))}),e.addEventListener("timeupdate",function(){updateProgress(e,n)},!1),e.addEventListener("pause",function(){t.querySelector("svg").innerHTML='<path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="M6.271 5.055a.5.5 0 0 1 .52.038l3.5 2.5a.5.5 0 0 1 0 .814l-3.5 2.5A.5.5 0 0 1 6 10.5v-5a.5.5 0 0 1 .271-.445"/>'},!1),e.addEventListener("play",function(){t.querySelector("svg").innerHTML='<path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="M6 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5m4 0a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5"/>'},!1),t.addEventListener("click",function(){e.paused?e.play():e.pause()},!1),document.getElementById("progressBarBg"+n));a.addEventListener("mousedown",function(t){var o;e.paused&&0==e.currentTime||(o=parseFloat(window.getComputedStyle(a,null).width.replace("px","")),t=t.offsetX/o,e.currentTime=PLAYER.duration*t,updateProgress(e,n))},!1),dragProgressDotEvent(e,n)}function dragProgressDotEvent(n,e){var o=document.getElementById("progressDot"+e),a={oriOffestLeft:0,oriX:0,maxLeft:0,maxRight:0},i=!1,c=(o.addEventListener("mousedown",t,!1),o.addEventListener("touchstart",t,!1),document.addEventListener("mousemove",r,!1),document.addEventListener("touchmove",r,!1),document.addEventListener("mouseup",s,!1),document.addEventListener("touchend",s,!1),null);function t(t){n.paused&&0==n.currentTime||(c=document.body.style.userSelect||document.body.style.webkitUserSelect,document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",i=!0,a.oriOffestLeft=o.offsetLeft,a.oriX=(t.touches?t.touches[0]:t).clientX,a.maxLeft=a.oriOffestLeft,a.maxRight=document.getElementById("progressBarBg"+e).offsetWidth-a.oriOffestLeft,t&&t.preventDefault?t.preventDefault():t.returnValue=!1,t&&t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0)}function r(t){var o;i&&((t=(t.touches?t.touches[0]:t).clientX-a.oriX)>a.maxRight?t=a.maxRight:t<-a.maxLeft&&(t=-a.maxLeft),o=document.getElementById("progressBarBg"+e),o=parseFloat(window.getComputedStyle(o,null).width.replace("px","")),t=(a.oriOffestLeft+t)/o,n.currentTime=PLAYER.duration*t,updateProgress(n,e))}function s(){document.body.style.userSelect=c,document.body.style.webkitUserSelect=c,i=!1}}function updateProgress(t,o){var n=t.currentTime/PLAYER.duration;document.getElementById("progressBar"+o).style.width=100*n+"%",document.getElementById("progressDot"+o).style.left=100*n+"%",document.getElementById("audioCurTime"+o).innerText=transTime(t.currentTime)}function transTime(t){var o=parseInt(t/3600),n=(t%=3600,parseInt(t/60)),t=parseInt(t%60);return formatTime(0<o?o+`:${n}:`+t:n+":"+t)}function formatTime(t){for(var o="",n=t.split(":"),e=0;e<n.length-1;e++)o=o+(1==n[e].length?"0"+n[e]:n[e])+":";return o+=1==n[e].length?"0"+n[e]:n[e]}responsiveDesign(!0),window.addEventListener("resize",function(){responsiveDesign(!0)}),document.addEventListener("DOMContentLoaded",function(){for(var t=document.querySelector(".audio-right"),t=parseFloat(window.getComputedStyle(t,null).width.replace("px")),o=0,n=("documentPictureInPicture"in window&&(o=47.6),document.querySelector(".audio-right p").style.maxWidth=t-o+"px",document.getElementsByTagName("audio")),e=0;e<n.length;e++)initAudioEvent(e)},!1);const searchBox=document.getElementById("search-box"),searchResults=document.getElementById("search-results");async function loadData(){try{var t=await loadJson();return(await JSON.parse(t)).data}catch(t){return console.error("failed to loading the search box of songs:",t),null}}var searchData=null;function getSearchData(){return searchData=null==searchData?loadData():searchData}async function searchSongs(t){if(t){const o=searchData=null==searchData?await getSearchData():searchData,n=t.toLowerCase(),e=o.filter(t=>t.song_name.toLowerCase().includes(n)||t.artist.toLowerCase().includes(n)||t.lrc_name.toLowerCase().includes(n)||t.album.toLowerCase().includes(n));searchResults.innerHTML=e.map(t=>`<li id='search-songs-${t.lrc_name}'><img src="./music/${t.lrc_name}.webp"><span><b>${t.song_name}</b> - ${t.artist}</span><span class="searchResultAlbum">${t.album}</span></li>`).join("")}else searchResults.innerHTML=""}function search_hide(){var t=document.getElementById("search-container");"none"==t.style.display?t.style.display="block":t.style.display="none"}function playmode_change(t){null!=localStorage.getItem("player_mode")&&(document.getElementById("menu_"+localStorage.getItem("player_mode")).style.color="#999"),localStorage.setItem("player_mode",t),document.getElementById("menu_"+t).style.color="#fff"}function font_change(t){var o=localStorage.getItem("player_font"),n=(null!=o&&(document.getElementById("menu_font_"+o).style.color="#999"),localStorage.setItem("player_font",t),document.getElementById("menu_font_"+t).style.color="#fff",document.getElementById("lyricWrapper"));switch(n.style.fontFamily=t,pipWindow.open&&(pipWindow.document.body.style.fontFamily=t),t){case"fordefault":case"youyuan":n.style.fontSize="16px";break;default:n.style.fontSize="18px"}}function lyricColorMode_change(t){if(null!=localStorage.getItem("lyricColorMode")&&(document.getElementById("menu_lyricColorMode_"+localStorage.getItem("lyricColorMode")).style.color="#999"),localStorage.setItem("lyricColorMode",t),document.getElementById("menu_lyricColorMode_"+t).style.color="#fff","choose"==t){localStorage.getItem("lyricColor")||localStorage.setItem("lyricColor","FAFA17,ff1493,adff2f,d731f8,00CC65");var o=localStorage.getItem("lyricColor").split(",");localStorage.setItem("lyricColor",o[0]);try{PLAYER.lyricStyleList=[o[0]],PLAYER.lyricStyle=Math.floor(Math.random()*PLAYER.lyricStyleList.length)}catch{}for(var n=1;n<o.length;n++)lyricColor_change(o[n])}}function showToast(t){var o=document.getElementById("toast");o.textContent=t,o.classList.add("show"),setTimeout(()=>{o.classList.remove("show")},1500)}function lyricColor_change(t){var o=document.getElementById("menu_lyricColor_"+t),n=(localStorage.getItem("lyricColor")||localStorage.setItem("lyricColor","FAFA17,ff1493,adff2f,d731f8,00CC65"),localStorage.getItem("lyricColor").split(","));if(localStorage.getItem("lyricColorMode")||localStorage.setItem("lyricColorMode","random"),"random"==localStorage.getItem("lyricColorMode"))if(1==n.length&&t==n[0]&&Array.from(o.className.split(" ")).includes("choosed"))showToast("操作失败:必须保留一种颜色");else{if(Array.from(o.className.split(" ")).includes("choosed")){o.classList.remove("choosed");for(var e=0,a=0;e<n.length;e++)n[e]!=t&&(n[a++]=n[e]);n.length=a}else o.classList.add("choosed"),n.includes(t)||n.push(t);try{for(var i=0,e=0;e<n.length;e++)if(n[e]==PLAYER.lyricStyleList[PLAYER.lyricStyle]){i=e;break}PLAYER.lyricStyleList=n,PLAYER.lyricStyle=i}catch{}for(var c=n[0],e=1;e<n.length;e++)c+=","+n[e];localStorage.setItem("lyricColor",c)}else if(localStorage.getItem("lyricColor")!=t){Array.from(document.getElementsByClassName("menu_lyricColor_button")).forEach(t=>{t.classList.remove("choosed")}),o.classList.add("choosed"),localStorage.setItem("lyricColor",t);try{PLAYER.lyricStyleList=[t],PLAYER.lyricStyle=0}catch{}}}searchBox.addEventListener("input",t=>{searchSongs(t.target.value)}),searchResults.addEventListener("click",t=>{for(var o=t.target;"li"!=o.tagName.toLowerCase();)o=o.parentNode;document.getElementById("search-box").value="",document.getElementById("search-results").innerHTML="",responsiveDesign(),PLAYER.playNum(parseInt(o.id.substring(13))-1)}),$(document).ready(function(){$(".menu-title").click(function(){$(this).siblings(".menu-content").toggleClass("show")})});var PLAYER,pipWindowMode=function(){this.window=void 0,this.document=void 0,this.open=!1,this.fillMode="lrc"},pipWindow=(pipWindowMode.prototype={constructor:pipWindowMode,create:async function(t){if(this.check()){PLAYER.desktopLyricButton.style.color="#"+PLAYER.lyricStyleList[PLAYER.lyricStyle],this.fillMode=t,this.window=await window.documentPictureInPicture.requestWindow({width:350,height:52}),this.document=this.window.document,this.document.body.title=document.title,this.open=!0;var o=this,t=("xrc"==this.fillMode?this.window.addEventListener("resize",function(){var t=document.getElementById("line-"+PLAYER.lastXrcLetterI);o.fillXrc(t)}):this.window.addEventListener("resize",function(){var t=o.document.getElementById("tool");t.fontSize=Math.min(Math.floor((o.window.innerWidth-40)/t.textContent.length),o.window.innerHeight-20)+"px"}),this.document.addEventListener("keydown",PLAYER.keyboardCtrl,!1),this.window.addEventListener("unload",function(){o.open=!1,o.window=void 0,o.document=void 0,o.fillMode=void 0,PLAYER.desktopLyricButton.style.color=""}),this.window.addEventListener("click",function(){PLAYER.audio.paused?PLAYER.audio.play():PLAYER.audio.pause()}),console.log("pipWindow has created."),this.document.head.innerHTML=document.head.innerHTML,document.createElement("link"));if(t.innerHTML='<link rel="stylesheet" href="css/pipWindow.min.css">',this.document.head.appendChild(t),this.document.body.style.fontFamily=localStorage.getItem("player_font"),"lrc"==this.fillMode)try{for(var n=0,e=PLAYER.lyric.length;n<=e;n++)if(n==e||PLAYER.audio.currentTime<=PLAYER.lyric[n][0]-.5){0<n&&n--,1<n&&PLAYER.lyric[n][0]==PLAYER.lyric[n-1][0]&&(n-=1);var a=null,i=PLAYER.lyric[n][1];n+1<e&&PLAYER.lyric[n][0]==PLAYER.lyric[n+1][0]&&(a=PLAYER.lyric[n+1][1]),0==i.length&&(i=" "),this.fill(i,a);break}}catch(t){console.error("ERROR:"+t)}else try{this.fillXrc(document.getElementById("line-"+PLAYER.lastXrcLetterI))}catch{}}},textLength:function(t){for(var o=0,n=0;n<t.length;n++){for(var e=!1,a=[" ",",",".","<",">",";",":",'"',"'","{","}","[","]","-","_","+","=","!","~","`","@","#","$","%","^","&","*","(",")","|","\\"],i=0;i<a.length;i++)if(t[n]==a[i]){e=!0;break}"a"<=t[n]&&t[n]<="z"||"A"<=t[n]&&t[n]<="Z"||e?o+=.5:o++}return o},fill:async function(t,o){var n,e,a;this.open&&((n=document.createElement("div")).id="tool",n.textContent=t,n.style.fontFamily=localStorage.getItem("player_font"),n.style.textShadow="1px 0 0 #000, -1px 0 0 #000, 0 1px 0 #000, 0 -1px 0 #000",n.style.fontWeight="bolder",n.style.lineHeight=this.window.innerHeight+"px",n.style.margin="auto",e=this.textLength(t),n.style.fontSize=Math.min(Math.floor((this.window.innerWidth-40)/e),this.window.innerHeight-20)+"px",n.style.color="#"+PLAYER.lyricStyleList[PLAYER.lyricStyle],this.document.body.innerHTML="",n.style.textAlign="center",n.style.lineHeight=this.window.innerHeight+"px",null!=o&&(a=this.textLength(o),n.style.fontSize=Math.min(Math.min(Math.floor((this.window.innerWidth-40)/e),(this.window.innerHeight-20)/2),Math.min(Math.floor((this.window.innerWidth-40)/a),this.window.innerHeight-20))+"px",e=document.createElement("div"),a=document.createElement("div"),n.style.lineHeight=Math.floor(this.window.innerHeight/2)+"px",n.textContent="",e.textContent=t,a.textContent=o,a.style.color="#fff",n.appendChild(e),n.appendChild(a)),this.document.body.appendChild(n))},fillXrc:function(t){var o,n,e;this.open&&(this.document.body.classList.add("current-line-xrc-"+PLAYER.lyricStyleList[PLAYER.lyricStyle]),this.document.body.innerHTML="",o=t.cloneNode(2),null==PLAYER.lyricTranslate?(n=this.window.innerHeight-20,o.style.fontSize=n+"px",Array.from(o.children).forEach(t=>{t.classList.add("lyricInline"),t.style.background="#fff -webkit-linear-gradient(left, #00CC65, #00CC65) no-repeat 0 0; !important"}),o.style.lineHeight=this.window.innerHeight+"px",this.document.body.appendChild(o),this.document.body.style.height=this.window.innerHeight+"px"):(n=Math.floor((this.window.innerHeight-20)/2),o.style.fontSize=1.2*n+"px",Array.from(o.children).forEach(t=>{t.classList.add("lyricInline")}),o.style.lineHeight=Math.floor(this.window.innerHeight/2*1.2)+"px",this.document.body.appendChild(o),this.document.body.style.height=this.window.innerHeight+"px",e=document.createElement("br"),this.document.body.appendChild(e),(e=t.parentNode.nextElementSibling.getElementsByTagName("span")[0].cloneNode(2))&&"translate"==e.getAttribute("lyric-mode")?(e.style.fontSize=.8*n+"px",e.style.lineHeight=Math.floor(this.window.innerHeight/2*.8)+"px",this.document.body.appendChild(e)):(this.document.body.classList.add("current-line-xrc-"+PLAYER.lyricStyleList[PLAYER.lyricStyle]),this.document.body.innerHTML="",n=this.window.innerHeight-20,o.style.fontSize=n+"px",Array.from(o.children).forEach(t=>{t.classList.add("lyricInline")}),o.style.lineHeight=this.window.innerHeight+"px",this.document.body.appendChild(o),this.document.body.style.height=this.window.innerHeight+"px")),e=(t=this.document.getElementById(`line-${PLAYER.lastXrcLetterI}-`+PLAYER.lastXrcLetterJ)).offsetLeft+this.textLength(t.textContent)*n-this.window.innerWidth/2,this.window.scrollTo({left:e}))},check:function(){return"documentPictureInPicture"in window||(console.error("pipWindow isn't supported."),!1)},close:function(){this.window.close()}},new pipWindowMode),mouseState=(document.addEventListener("keydown",function(t){"p"==t.key&&(pipWindow.open?pipWindow.close():pipWindow.create(PLAYER.lyricMode))}),window.addEventListener("load",function(){var n,e,o,a,i,c,r,s,l,u,h,d,t=localStorage.getItem("player_mode"),t=(null==t&&(localStorage.setItem("player_mode","order"),t="order"),playmode_change(t),localStorage.getItem("player_font")),t=(null==t&&(localStorage.setItem("player_font","fordefault"),t="fordefault"),font_change(t),localStorage.getItem("lyricColorMode")),m=(t||(localStorage.setItem("lyricColorMode","random"),t="random"),lyricColorMode_change(t),localStorage.getItem("lyricColor")||localStorage.setItem("lyricColor","FAFA17,ff1493,adff2f,d731f8,00CC65"),localStorage.getItem("lyricColor"));function f(t){if("block"!=e.style.display)o=!1;else{if(!a.contains(t.target))return document.body.style.userSelect=c,document.body.style.webkitUserSelect=c,o=!(i=!1),void(e.style.display="none");c=document.body.style.userSelect||document.body.style.webkitUserSelect,document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",i=!0}}function p(t){var o;t.preventDefault(),i&&(t=(t.touches?t.touches[0]:t).clientY-a.getBoundingClientRect().top,t=((o=parseFloat(window.getComputedStyle(a,null).height.replace("px")))-t)/o,o=e.getElementsByClassName("bar")[0],t=Math.max(t,0),t=Math.min(t,1),PLAYER.audio.volume=t,PLAYER.volume=t,n.title=`调节音量 ${Math.round(100*t)}%
增大：Ctrl + Up
减小：Ctrl + Down`,document.querySelector("#volumeButton svg").innerHTML=0==t?'<path d="M6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06M6 5.04 4.312 6.39A.5.5 0 0 1 4 6.5H2v3h2a.5.5 0 0 1 .312.11L6 10.96zm7.854.606a.5.5 0 0 1 0 .708L12.207 8l1.647 1.646a.5.5 0 0 1-.708.708L11.5 8.707l-1.646 1.647a.5.5 0 0 1-.708-.708L10.793 8 9.146 6.354a.5.5 0 1 1 .708-.708L11.5 7.293l1.646-1.647a.5.5 0 0 1 .708 0"/>':1==t?'<path d="M11.536 14.01A8.47 8.47 0 0 0 14.026 8a8.47 8.47 0 0 0-2.49-6.01l-.708.707A7.48 7.48 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303z"/><path d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.48 5.48 0 0 1 11.025 8a5.48 5.48 0 0 1-1.61 3.89z"/><path d="M10.025 8a4.5 4.5 0 0 1-1.318 3.182L8 10.475A3.5 3.5 0 0 0 9.025 8c0-.966-.392-1.841-1.025-2.475l.707-.707A4.5 4.5 0 0 1 10.025 8M7 4a.5.5 0 0 0-.812-.39L3.825 5.5H1.5A.5.5 0 0 0 1 6v4a.5.5 0 0 0 .5.5h2.325l2.363 1.89A.5.5 0 0 0 7 12zM4.312 6.39 6 5.04v5.92L4.312 9.61A.5.5 0 0 0 4 9.5H2v-3h2a.5.5 0 0 0 .312-.11"/>':'<path d="M9 4a.5.5 0 0 0-.812-.39L5.825 5.5H3.5A.5.5 0 0 0 3 6v4a.5.5 0 0 0 .5.5h2.325l2.363 1.89A.5.5 0 0 0 9 12zM6.312 6.39 8 5.04v5.92L6.312 9.61A.5.5 0 0 0 6 9.5H4v-3h2a.5.5 0 0 0 .312-.11M12.025 8a4.5 4.5 0 0 1-1.318 3.182L10 10.475A3.5 3.5 0 0 0 11.025 8 3.5 3.5 0 0 0 10 5.525l.707-.707A4.5 4.5 0 0 1 12.025 8"/>',o.style.height=100*t+"%",e.getElementsByClassName("percent")[0].textContent=Math.round(100*t)+"%",o.style.top=100*(1-t)+"%",e.getElementsByClassName("dot")[0].style.top=`calc(${100*(1-t)}% - 5px)`)}function y(){document.body.style.userSelect=c,document.body.style.webkitUserSelect=c,i=!1}function g(t){if("block"!=s.style.display)l=!1;else{if(!u.contains(t.target))return document.body.style.userSelect=d,document.body.style.webkitUserSelect=d,l=!(h=!1),void(s.style.display="none");d=document.body.style.userSelect||document.body.style.webkitUserSelect,document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",h=!0}}function v(t){if(t.preventDefault(),h){var t=(t.touches?t.touches[0]:t).clientY-u.getBoundingClientRect().top,t=8*Math.round(t/8),o=parseFloat(window.getComputedStyle(u,null).height.replace("px")),t=(o-t)/o,t=Math.max(t,0);t=Math.min(t,1),PLAYER.audio.playbackRate=t+.5,PLAYER.playbackRate=t+.5;for(var n=(Math.round(100*(t+.5))/100).toString();n.length<4;)n+="0";r.textContent="1000"==n?"倍速":n+"x";o=u.getElementsByClassName("bar")[0];o.style.height=100*t+"%",o.style.top=100*(1-t)+"%",s.getElementsByClassName("dot")[0].style.top=`calc(${100*(1-t)}% - 5px)`}}function A(){document.body.style.userSelect=d,document.body.style.webkitUserSelect=d,h=!1}Array.from(m.split(",")).forEach(t=>{lyricColor_change(t)}),"choose"==t&&document.getElementById("menu_lyricColor_"+m).classList.add("choosed"),n=document.getElementById("volumeButton"),e=document.getElementById("volumeConfig"),o=!1,n.addEventListener("click",function(){"block"==e.style.display?e.style.display="none":o?o=!1:e.style.display="block"}),(a=e.getElementsByClassName("bar-bg")[0]).addEventListener("click",t=>{var t=t.clientY-a.getBoundingClientRect().top,o=parseFloat(window.getComputedStyle(a,null).height.replace("px")),t=(o-t)/o,o=(PLAYER.audio.volume=t,PLAYER.volume=t,n.title=`调节音量 ${Math.round(100*t)}%
增大：Ctrl + Up
减小：Ctrl + Down`,document.querySelector("#volumeButton svg").innerHTML=0==t?'<path d="M6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06M6 5.04 4.312 6.39A.5.5 0 0 1 4 6.5H2v3h2a.5.5 0 0 1 .312.11L6 10.96zm7.854.606a.5.5 0 0 1 0 .708L12.207 8l1.647 1.646a.5.5 0 0 1-.708.708L11.5 8.707l-1.646 1.647a.5.5 0 0 1-.708-.708L10.793 8 9.146 6.354a.5.5 0 1 1 .708-.708L11.5 7.293l1.646-1.647a.5.5 0 0 1 .708 0"/>':1==t?'<path d="M11.536 14.01A8.47 8.47 0 0 0 14.026 8a8.47 8.47 0 0 0-2.49-6.01l-.708.707A7.48 7.48 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303z"/><path d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.48 5.48 0 0 1 11.025 8a5.48 5.48 0 0 1-1.61 3.89z"/><path d="M10.025 8a4.5 4.5 0 0 1-1.318 3.182L8 10.475A3.5 3.5 0 0 0 9.025 8c0-.966-.392-1.841-1.025-2.475l.707-.707A4.5 4.5 0 0 1 10.025 8M7 4a.5.5 0 0 0-.812-.39L3.825 5.5H1.5A.5.5 0 0 0 1 6v4a.5.5 0 0 0 .5.5h2.325l2.363 1.89A.5.5 0 0 0 7 12zM4.312 6.39 6 5.04v5.92L4.312 9.61A.5.5 0 0 0 4 9.5H2v-3h2a.5.5 0 0 0 .312-.11"/>':'<path d="M9 4a.5.5 0 0 0-.812-.39L5.825 5.5H3.5A.5.5 0 0 0 3 6v4a.5.5 0 0 0 .5.5h2.325l2.363 1.89A.5.5 0 0 0 9 12zM6.312 6.39 8 5.04v5.92L6.312 9.61A.5.5 0 0 0 6 9.5H4v-3h2a.5.5 0 0 0 .312-.11M12.025 8a4.5 4.5 0 0 1-1.318 3.182L10 10.475A3.5 3.5 0 0 0 11.025 8 3.5 3.5 0 0 0 10 5.525l.707-.707A4.5 4.5 0 0 1 12.025 8"/>',a.getElementsByClassName("bar")[0]);o.style.height=100*t+"%",e.getElementsByClassName("percent")[0].textContent=Math.round(100*t)+"%",o.style.top=100*(1-t)+"%",e.getElementsByClassName("dot")[0].style.top=`calc(${100*(1-t)}% - 5px)`}),i=!1,c=null,document.addEventListener("mousedown",f),document.addEventListener("mousemove",p),document.addEventListener("mouseup",y),document.addEventListener("touchstart",f),document.addEventListener("touchmove",p),document.addEventListener("touchend",y),r=document.getElementById("playbackRateButton"),s=document.getElementById("playbackRateConfig"),l=!1,r.addEventListener("click",function(){"block"==s.style.display?s.style.display="none":l?l=!1:s.style.display="block"}),(u=s.getElementsByClassName("bar-bg")[0]).addEventListener("click",t=>{for(var t=t.clientY-u.getBoundingClientRect().top,t=8*Math.round(t/8),o=parseFloat(window.getComputedStyle(u,null).height.replace("px")),t=(o-t)/o,n=(PLAYER.audio.playbackRate=.5+t,PLAYER.playbackRate=.5+t,(Math.round(100*(.5+t))/100).toString());n.length<4;)n+="0";r.textContent="1000"==n?"倍速":n+"x";o=u.getElementsByClassName("bar")[0];o.style.height=100*t+"%",o.style.top=100*(1-t)+"%",s.getElementsByClassName("dot")[0].style.top=`calc(${100*(1-t)}% - 5px)`}),h=!1,d=null,document.addEventListener("mousedown",g),document.addEventListener("mousemove",v),document.addEventListener("mouseup",A),document.addEventListener("touchstart",g),document.addEventListener("touchmove",v),document.addEventListener("touchend",A),"documentPictureInPicture"in window&&(document.getElementById("desktopLyricButton").style.display="block");var w=document.getElementById("configButton"),L=document.getElementById("config");w.addEventListener("click",function(){L.style.display="block",L.style.animation="fadeIn 100ms linear",this.style.display="none"}),document.getElementById("configBackButton").addEventListener("click",function(){L.style.display="none",w.style.display="block"}),document.getElementById("configDefaultButton").addEventListener("click",function(){font_change("fordefault"),playmode_change("order"),lyricColorMode_change("random"),localStorage.setItem("lyricColor","FAFA17,ff1493,adff2f,d731f8,00CC65");for(var t=localStorage.getItem("lyricColor").split(","),o=0,n=0;n<t.length;n++)if(PLAYER.lyricStyleList[PLAYER.lyricStyle]==t[n]){o=n;break}PLAYER.lyricStyle=o,PLAYER.lyricStyleList=t,Array.from(document.getElementsByClassName("menu_lyricColor_button")).forEach(t=>{t.classList.add("choosed")})}),(PLAYER=new Selected).init()}),"up"),mouseStateTime=0,mouseTouchStart=!1,mouseInLyricContainer=!1;async function FetchJson(){console.log("fetch content.json.");var t=await(await fetch("json/content.json")).json(),t=JSON.stringify(t);localStorage.setItem("content.json",t)}async function loadJson(){var t=sessionStorage.getItem("counterForContent");return localStorage.getItem("content.json")?null==t&&(sessionStorage.setItem("counterForContent",1),FetchJson()):null==t&&await FetchJson(),localStorage.getItem("content.json")}function mainRGB(t){var o=document.createElement("canvas"),n=o.getContext("2d");o.width=t.width,o.height=t.height,n.drawImage(t,0,0);for(var e=n.getImageData(0,0,o.width,o.height).data,a={},i=0;i<e.length;i+=4)a[c=e[i]+`,${e[i+1]},`+e[i+2]]||(a[c]={count:0,color:c}),a[c].count++;var c,r="",s=0;for(c in a)a[c].count>s&&(s=a[c].count,r=a[c].color);return`rgb(${r})`}document.addEventListener("touchstart",function(){mouseStateTime=(new Date).getTime(),mouseState="down",mouseTouchStart=!0}),document.addEventListener("mousedown",function(){mouseStateTime=(new Date).getTime(),mouseState="down"}),document.addEventListener("mouseup",function(){mouseStateTime=(new Date).getTime(),mouseState="up"}),document.addEventListener("touchend",function(){mouseStateTime=(new Date).getTime(),mouseTouchStart=!(mouseState="up")}),document.getElementById("lyricWrapper").addEventListener("scroll",function(){mouseStateTime=(new Date).getTime(),mouseState="scroll"});var Selected=function(){this.audio=document.getElementById("audio"),this.lyricContainer=document.getElementById("lyricContainer"),this.playlist=document.getElementById("playlist"),this.lyricWrapper=document.getElementById("lyricWrapper"),this.cover_img=document.getElementById("cover_img"),this.disapointer=document.getElementById("disapointer"),this.cover_disc=document.getElementById("cover_disc"),this.cover_disc_img=document.getElementById("cover_disc_img"),this.desktopLyricButton=document.getElementById("desktopLyricButton"),this.currentIndex=0,this.lyric=null,this.lyricStyle=0,localStorage.getItem("lyricColor")||localStorage.setItem("lyricColor","FAFA17,ff1493,adff2f,d731f8,00CC65"),this.lyricStyleList=localStorage.getItem("lyricColor").split(","),localStorage.getItem("lyricColorMode")||localStorage.setItem("lyricColorMode","random"),"choose"==localStorage.getItem("lyricColorMode")&&(this.lyricStyleList=[localStorage.getItem("lyricColor").split(",")[0]]),this.lyricMode="lrc",this.clickedToSetCurrentTime=!1,this.last=-1,this.lastXrcLetterI=null,this.lastXrcLetterJ=null,this.lyricTranslate=null,this.lastHasTwoLanguage=!1,this.audio_name=[],this.audio_artist=[],this.audio_album=[],this.duration=0,this.audio_duration=[],this.volume=1,this.playbackRate=1},cvs=(Selected.prototype={constructor:Selected,init:async function(){await this.initialList();var t,i=this,o=this.playlist.children[0].children,n=window.location.hash.substring(1),n=1<=n&&n<=o.length?n:0,e=(this.currentIndex=n||Math.floor(Math.random()*o.length)+1,this.currentIndex=this.currentIndex-1,t=(n=o[this.currentIndex]).children[0].getAttribute("data-name"),window.location.hash=window.location.hash||t,this.playlist.addEventListener("click",function(t){var o,n;"a"==t.target.nodeName.toLowerCase()&&(o=i.playlist.children[0].children,o=Array.prototype.indexOf.call(o,t.target.parentNode),n=i.currentIndex,i.currentIndex=o,i.setClass(n,o),n=t.target.getAttribute("data-name"),window.location.hash=n,i.play(n))},!1),this.audio.onended=function(){i.ending()},this.audio.onerror=function(t){console.error("audio load error:"+t);t=sessionStorage.getItem("audioErrorCount");null==t&&(t=0),++t<=2?i.play(i.currentIndex+1):i.lyricContainer.textContent="歌曲加载失败,请检查网络或清空缓存并重试"},this.lyricContainer.addEventListener("click",t=>{if(!(this.lyric.length<=1)){t=t.target;if("span"==t.tagName.toLowerCase()){if("span"==t.parentNode.tagName.toLowerCase()&&(t=t.parentNode),"lrc"==i.lyricMode)return i.audio.currentTime=i.lyric[t.id.substring(5)][0]/1e3,i.audio.play(),"scroll"==mouseState&&1500<(new Date).getTime()-mouseStateTime&&(mouseTouchStart||(mouseState="up")),void("up"==mouseState&&i.lyricWrapper.scrollTo(0,line.offsetTop));console.log("lyric-mode:",t.getAttribute("lyric-mode"));try{if(i.lyric)for(var o=0;o<i.lyric.length;o++){var n=i.lyric[o];document.getElementById("line-"+o).className="";for(var e=0;e<n.length;e++){var a=document.getElementById(`line-${o}-`+e);a.style.animationName="",a.style.animationDuration="",a.style.animationTimingFunction="",a.className=""}}}catch(t){console.error("ERROR:"+t)}"translate"==t.getAttribute("lyric-mode")?(i.audio.currentTime=t.getAttribute("start-time")/1e3,i.audio.play(),"scroll"==mouseState&&1500<(new Date).getTime()-mouseStateTime&&(mouseTouchStart||(mouseState="up")),"up"==mouseState&&i.lyricWrapper.scrollTo(0,t.parentNode.previousSibling.offsetTop),console.log("change currentTime when click.(translateLyric)")):(i.audio.currentTime=t.getAttribute("start-time")/1e3,i.audio.play(),"scroll"==mouseState&&1500<(new Date).getTime()-mouseStateTime&&(mouseTouchStart||(mouseState="up")),"up"==mouseState&&i.lyricWrapper.scrollTo(0,t.offsetTop),console.log("change currentTime when click.(normalLyric)"))}}}),window.addEventListener("keydown",this.keyboardCtrl,!1),localStorage.getItem("bgMode"));null==e&&(e="imageBg",localStorage.setItem("bgMode","imageBg")),document.getElementsByTagName("html")[0].className=e,document.getElementById("bg_dark").addEventListener("click",function(){document.getElementsByTagName("html")[0].className="colorBg",localStorage.setItem("bgMode","colorBg")}),document.getElementById("bg_pic").addEventListener("click",function(){document.getElementsByTagName("html")[0].className="imageBg",localStorage.setItem("bgMode","imageBg")}),document.getElementById("bg_half").addEventListener("click",function(){document.getElementsByTagName("html")[0].className="halfBg",localStorage.setItem("bgMode","halfBg")});for(var a=o.length-1;0<=a;a--)o[a].className="";n.className="current-song",this.audio.addEventListener("timeupdate",function(){this.currentTime>i.duration&&i.ending(),i.syncLyric()}),this.audio.addEventListener("pause",function(){if("xrc"==i.lyricMode)try{null!=i.lastXrcLetterI&&(document.getElementById(`line-${i.lastXrcLetterI}-`+i.lastXrcLetterJ).style.animationPlayState="paused",pipWindow.open&&(pipWindow.document.getElementById(`line-${i.lastXrcLetterI}-`+i.lastXrcLetterJ).style.animationPlayState="paused"))}catch(t){console.error("ERROR:"+t)}i.cover_img.classList.add("paused"),i.cover_disc.classList.add("paused"),i.cover_disc_img.classList.add("paused"),i.disapointer.classList.remove("rotate")}),this.audio.addEventListener("play",function(){if("xrc"==i.lyricMode)try{i.lastXrcLetterI&&(document.getElementById(`line-${i.lastXrcLetterI}-`+i.lastXrcLetterJ).style.animationPlayState="running",pipWindow.open&&(pipWindow.document.getElementById(`line-${i.lastXrcLetterI}-`+i.lastXrcLetterJ).style.animationPlayState="running"))}catch(t){console.error("ERROR:"+t)}i.cover_img.classList.remove("paused"),i.cover_disc.classList.remove("paused"),i.cover_disc_img.classList.remove("paused"),i.disapointer.classList.add("rotate")}),this.cover_img.addEventListener("click",function(){i.audio.paused?i.audio.play():i.audio.pause()}),"documentPictureInPicture"in window&&this.desktopLyricButton.addEventListener("click",function(){pipWindow.open?pipWindow.close():pipWindow.create(i.lyricMode)}),console.log("inited.It's time to play the song now."),this.play(t)},keyboardCtrl:function(t){var i=PLAYER;function o(t){var o=document.getElementById("volumeConfig"),n=o.getElementsByClassName("bar-bg")[0],t=Math.max(Math.min(i.audio.volume+t,1),0),n=(i.audio.volume=t,i.volume=t,volumeButton.title=`调节音量 ${Math.round(100*t)}%
增大：Ctrl + Up
减小：Ctrl + Down`,document.querySelector("#volumeButton svg").innerHTML=0==t?'<path d="M6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06M6 5.04 4.312 6.39A.5.5 0 0 1 4 6.5H2v3h2a.5.5 0 0 1 .312.11L6 10.96zm7.854.606a.5.5 0 0 1 0 .708L12.207 8l1.647 1.646a.5.5 0 0 1-.708.708L11.5 8.707l-1.646 1.647a.5.5 0 0 1-.708-.708L10.793 8 9.146 6.354a.5.5 0 1 1 .708-.708L11.5 7.293l1.646-1.647a.5.5 0 0 1 .708 0"/>':1==t?'<path d="M11.536 14.01A8.47 8.47 0 0 0 14.026 8a8.47 8.47 0 0 0-2.49-6.01l-.708.707A7.48 7.48 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303z"/><path d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.48 5.48 0 0 1 11.025 8a5.48 5.48 0 0 1-1.61 3.89z"/><path d="M10.025 8a4.5 4.5 0 0 1-1.318 3.182L8 10.475A3.5 3.5 0 0 0 9.025 8c0-.966-.392-1.841-1.025-2.475l.707-.707A4.5 4.5 0 0 1 10.025 8M7 4a.5.5 0 0 0-.812-.39L3.825 5.5H1.5A.5.5 0 0 0 1 6v4a.5.5 0 0 0 .5.5h2.325l2.363 1.89A.5.5 0 0 0 7 12zM4.312 6.39 6 5.04v5.92L4.312 9.61A.5.5 0 0 0 4 9.5H2v-3h2a.5.5 0 0 0 .312-.11"/>':'<path d="M9 4a.5.5 0 0 0-.812-.39L5.825 5.5H3.5A.5.5 0 0 0 3 6v4a.5.5 0 0 0 .5.5h2.325l2.363 1.89A.5.5 0 0 0 9 12zM6.312 6.39 8 5.04v5.92L6.312 9.61A.5.5 0 0 0 6 9.5H4v-3h2a.5.5 0 0 0 .312-.11M12.025 8a4.5 4.5 0 0 1-1.318 3.182L10 10.475A3.5 3.5 0 0 0 11.025 8 3.5 3.5 0 0 0 10 5.525l.707-.707A4.5 4.5 0 0 1 12.025 8"/>',n.getElementsByClassName("bar")[0]);n.style.height=100*t+"%",o.getElementsByClassName("percent")[0].textContent=Math.round(100*t)+"%",n.style.top=100*(1-t)+"%",o.getElementsByClassName("dot")[0].style.top=`calc(${100*(1-t)}% - 5px)`}function n(t){var o=document.getElementById("playbackRateButton"),n=document.getElementById("playbackRateConfig"),e=n.getElementsByClassName("bar-bg")[0],n=n.getElementsByClassName("dot")[0],e=e.getElementsByClassName("bar")[0],t=i.audio.playbackRate-.5+t,t=Math.min(t,1);t=Math.max(t,0),PLAYER.audio.playbackRate=t+.5,PLAYER.playbackRate=t+.5;for(var a=(Math.round(100*(t+.5))/100).toString();a.length<4;)a+="0";o.textContent="1000"==a?"倍速":a+"x",e.style.height=100*t+"%",e.style.top=100*(1-t)+"%",n.style.top=`calc(${100*(1-t)}% - 5px)`}t.ctrlKey?"ArrowUp"==t.code?o(.1):"ArrowDown"==t.code&&o(-.1):t.altKey?"ArrowUp"==t.code?n(.05):"ArrowDown"==t.code&&n(-.05):("ArrowUp"==t.code?i.playPrev():"ArrowDown"==t.code?i.playNext():"ArrowLeft"==t.code?i.audio.currentTime-=Math.min(i.audio.currentTime,10):"ArrowRight"==t.code?i.audio.currentTime+=10:" "==t.key&&(i.audio.paused?i.audio.play():i.audio.pause()),document.getElementById("volumeConfig").style.display="none",document.getElementById("playbackRateConfig").style.display="none")},initialList:async function(){var a=this,t=await loadJson(),i=document.createDocumentFragment(),t=JSON.parse(t).data,o=this.playlist.getElementsByTagName("ol")[0],i=document.createDocumentFragment();t.forEach(function(t,o,n){var e=document.createElement("li");(n=document.createElement("a")).href="javascript:void(0)",n.dataset.name=t.lrc_name,n.textContent=t.song_name+" - "+t.artist,a.audio_name[o]=t.song_name,a.audio_artist[o]=t.artist,a.audio_album[o]=t.album,a.audio_duration[o]=t.duration,e.appendChild(n),e.id="playlist-"+o,i.appendChild(e)}),o.appendChild(i)},mediaSessionAPI:function(t){var o,n=this;return"mediaSession"in navigator&&(o=this.audio_name[this.currentIndex]+" - "+this.audio_artist[this.currentIndex],navigator.mediaSession.metadata=new MediaMetadata({title:o,artist:t,artwork:[{src:n.cover_img.src}]}),navigator.mediaSession.setActionHandler("seekbackward",function(){n.audio.currentTime-=Math.min(10,audio.currentTime)}),navigator.mediaSession.setActionHandler("seekforward",function(){n.audio.currentTime+=Math.min(10,PLAYER.duration-audio.currentTime)}),navigator.mediaSession.setActionHandler("previoustrack",function(){n.playPrev()}),navigator.mediaSession.setActionHandler("nexttrack",function(){n.playNext()}),navigator.mediaSession.setActionHandler("play",function(){n.audio.play()}),navigator.mediaSession.setActionHandler("pause",function(){n.audio.pause()}),!0)},play:function(t){var o=this,n=(document.documentElement.style.setProperty("--halfBg-background-img",`url(../music/${t}.webp)`),this.currentIndex-1),n=(n<0&&(n=this.audio_name.length-1),document.getElementById("playPrevButton").title=`上一首 Up
${this.audio_name[n]} - `+this.audio_artist[n],this.currentIndex+1),n=(n>=this.audio_name.length&&(n=0),document.getElementById("playNextButton").title=`上一首 Up
${this.audio_name[n]} - `+this.audio_artist[n],this.lyricTranslate=null,this.lastXrcLetterI=this.lastXrcLetterJ=null,this.lyricContainer.textContent="loading song...",this.audio.src=`music/${t}.mp3`,this.cover_img.src=`music/${t}.webp`,this.cover_disc_img.src=`music/${t}.webp`,this.disapointer.classList.remove("playing"),this.disapointer.classList.remove("rotate"),this.cover_img.addEventListener("load",function(){this.style.borderColor=mainRGB(this),this.classList.add("rotate"),o.cover_disc.classList.add("rotate"),o.cover_disc_img.classList.add("rotate"),o.disapointer.classList.add("playing"),o.disapointer.classList.add("rotate")},{once:!0}),console.log("change the src."),this.audio.currentTime=0,this.audio.addEventListener("canplay",function(){o.audio.volume=o.volume,o.audio.playbackRate=o.playbackRate,o.audio.play(),o.getLyric("music/"+t)},{once:!0}),this.audio.play(),document.getElementById("playlist_ol")),e=document.getElementById("playlist-"+PLAYER.currentIndex),n=(n.scrollTo({top:Math.max(0,Math.max(0,e.offsetTop-Math.floor(parseInt(this.playlist.clientHeight)/2))),behavior:"smooth"}),document.getElementById("songinfo_audio").textContent=document.getElementById("playlist-"+this.currentIndex).textContent,document.title=document.getElementById("songinfo_audio").textContent+" | XPlayer",pipWindow.open&&(pipWindow.document.body.title=document.title),document.getElementById("songinfo_name").textContent=this.audio_name[this.currentIndex],document.getElementById("songinfo_artist").textContent="歌手: "+this.audio_artist[this.currentIndex],document.getElementById("songinfo_album").textContent="专辑: "+this.audio_album[this.currentIndex],this.duration=this.audio_duration[this.currentIndex],this.mediaSessionAPI(" "),window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight);this.lyricContainer.style.top=Math.floor(.4*(n-100)),this.lyric=null,this.lyricStyle=4,this.lyricStyle=Math.floor(Math.random()*this.lyricStyleList.length),this.desktopLyricButton.style.color&&(this.desktopLyricButton.style.color="#"+this.lyricStyleList[this.lyricStyle])},getLyricFetch:async function(t){var o;try{const n=await fetch(t);o=0==n.ok?null:await n.text()}catch{}return o},getLyric:async function(t){this.lyricContainer.textContent="loading lyric...";var o=await this.getLyricFetch(t+".xrc");null!=o?(this.lyricMode="xrc",this.lyricTranslate=await this.getLyricFetch(t+"_ts.xrc")):(this.lyricMode="lrc",o=await this.getLyricFetch(t+".lrc")),this.lyric=this.parseLyric(o),this.appendLyric(this.lyric)},parseLyricLrc:function(t){for(var o=t.split("\n"),i=/\[\d{2}:\d{2}.\d{2}\]/g,c=[],r=this.getOffset(t);!i.test(o[0]);)o=o.slice(1);return 0==o[o.length-1].length&&o.pop(),o.forEach(function(t,o,n){var e=t.match(i),a=t.replace(i,"");e.forEach(function(t,o,n){t=t.slice(1,-1).split(":");c.push([1e3*(60*parseInt(t[0],10)+parseFloat(t[1])+parseInt(r)),a])})}),c.sort(function(t,o){return t[0]-o[0]}),c},parseLyricXrc:function(t){var o=(new DOMParser).parseFromString(t,"text/xml");console.log(o);try{t=o.getElementsByTagName("Lyric_1")[0].getAttribute("LyricContent")}catch(t){console.error(t),alert(".xrc 歌词解析出错.\nfailed to load lyric.")}for(var n=[],e=0;e<t.length;e++)"["==t[e]&&0<e&&(n+="\n"),n+=t[e];if(!(t=n))return null;const a=t,i=a.split("\n").filter(t=>""!==t.trim()),l=[];return i.forEach(t=>{const o=t.match(/\[\s*-?\d+\s*,\s*-?\d+\s*\]/);if(o){const c=o.input.substring(o[0].length),r=[],s=[...c.matchAll(/\(\s*-?\d+\s*,\s*-?\d+\s*\)/g)];for(var n=0;n<s.length;n++){var e=c.substring(0<n?s[n-1].index+s[n-1][0].length:0,s[n].index),a=s[n][0].match(/-?\d+/g),i=parseInt(a[0]),a=parseInt(a[0])+parseInt(a[1])-1;r.push([e,i,a])}l.push(r)}}),l},parseLyric:function(t){return"lrc"==this.lyricMode?this.parseLyricLrc(t):this.parseLyricXrc(t)},appendLyricLrc:function(t){var o=this.lyricContainer,i=document.createDocumentFragment();this.lyricContainer.innerHTML="";t.forEach(function(t,o,n){var e=document.createElement("p"),a=document.createElement("span");a.id="line-"+o,a.textContent=t[1],a.classList.add("lyric-line"),a.style.backgroundClip="text",a.style.webkitBackgroundClip="text",e.appendChild(a),i.appendChild(e)}),o.appendChild(i)},appendLyricXrc:function(t){var o=!1,n=null;if(null!=this.lyricTranslate){o=!0,console.log("Translating lyrics is available.");for(var n=this.parseLyricLrc(this.lyricTranslate),e=0,a=0;e<n.length;e++)"//\r"!=n[e][1]&&"\r"!=n[e][1]&&"//"!=n[e][1]&&""!=n[e][1]&&(n[a++]=n[e]);n.length=a,console.log(n),console.log(t)}var i=this.lyricContainer,c=document.createDocumentFragment(),r=0;this.lyricContainer.innerHTML="";for(e=0;e<t.length;e++){var s=document.createElement("p"),l=document.createElement("span");l.id="line-"+e,l.classList.add("lyric-line"),l.setAttribute("start-time",t[e][0][1]),l.setAttribute("lyric-mode","normal"),l.setAttribute("word","");for(a=0;a<t[e].length;a++){var u=document.createElement("span");u.style.backgroundClip="text",u.style.webkitBackgroundClip="text",u.id=l.id+"-"+a,u.textContent=t[e][a][0],l.setAttribute("word",l.getAttribute("word")+u.textContent),l.appendChild(u)}s.appendChild(l),c.appendChild(s),o&&r<n.length&&Math.abs(t[e][0][1]-n[r][0])<=1e3&&(s=document.createElement("p"),(l=document.createElement("span")).textContent=n[r++][1],l.classList.add("translateLyric"),l.classList.add("lyric-line"),l.setAttribute("start-time",t[e][0][1]),l.setAttribute("lyric-mode","translate"),s.appendChild(l),c.appendChild(s))}i.appendChild(c)},appendLyric:function(t){"lrc"==this.lyricMode?this.appendLyricLrc(t):this.appendLyricXrc(t)},syncLyricLrc:function(){this.lyricContainer.className="";try{if(!this.lyric)return;for(var t=1e3*this.audio.currentTime+500,o=0,n=this.lyric.length;o<=n;o++){if(o==n||t<=this.lyric[o][0]){0<o&&o--,1<o&&this.lyric[o][0]==this.lyric[o-1][0]&&o--,(i=document.getElementById("line-"+o)).className="current-line-"+this.lyricStyleList[this.lyricStyle],o!=this.last&&(this.last=o,"scroll"==mouseState&&1500<(new Date).getTime()-mouseStateTime&&(mouseTouchStart||(mouseState="up")),"up"==mouseState&&this.lyricWrapper.scrollTo(0,i.offsetTop));var e=null,a=this.lyric[o][1];o+1<n&&this.lyric[o][0]==this.lyric[o+1][0]&&(e=this.lyric[o+1][1]),0==a.length&&(a=" "),this.mediaSessionAPI(a),pipWindow.fill(a,e);for(var i,c=o+1;c<n;c++)(i=document.getElementById("line-"+c)).className="",i.classList.add("lyric-line");break}try{(i=document.getElementById("line-"+o)).className="",i.classList.add("lyric-line")}catch{console.error("error on #"+o)}}}catch(t){console.error("ERROR:"+t)}},syncLyricXrc:function(){this.lyricContainer.classList.add("current-line-xrc-"+this.lyricStyleList[this.lyricStyle]);try{if(!this.lyric)return;for(var t=1e3*this.audio.currentTime+250,o=0;o<this.lyric.length;o++){var n=this.lyric[o];if(t<=n[n.length-1][2]+.25){(e=document.getElementById("line-"+o)).classList.add("current-line"),o!=this.last&&("scroll"==mouseState&&1500<(new Date).getTime()-mouseStateTime&&(mouseTouchStart||(mouseState="up")),"up"==mouseState&&this.lyricWrapper.scrollTo(0,e.offsetTop),this.last=o),t>=n[0][1]&&this.mediaSessionAPI(e.getAttribute("word"));for(var e,a=0;a<n.length;a++){var i=document.getElementById(`line-${o}-`+a);if(!(t>n[a][2])){if(t<n[a][1])break;i.classList.add("current-line-xrc-playing-"+this.lyricStyleList[this.lyricStyle]),this.lastXrcLetterI==o&&this.lastXrcLetterJ==a||(i.style.animationName="lyric_sync_letter",i.style.animationTimingFunction="linear",i.style.animationDuration=(n[a][2]-n[a][1])*(1/this.audio.playbackRate)+"ms",this.lastXrcLetterI=o,this.lastXrcLetterJ=a,pipWindow.fillXrc(document.getElementById("line-"+this.lastXrcLetterI)));break}i.classList.add("current-line-xrc-played-"+this.lyricStyleList[this.lyricStyle]),i.classList.remove("current-line-xrc-playing-"+this.lyricStyleList[this.lyricStyle])}for(o++;o<this.lyric.length;o++)try{(e=document.getElementById("line-"+o)).className="",e.classList.add("lyric-line"),document.getElementById("line-"+o).classList.add("current-line-xrc"),e.style="",Array.from(e.getElementsByTagName("span")).forEach(t=>{t.className="",t.style="background-clip: text"})}catch{console.error("error on #"+a)}break}try{(e=document.getElementById("line-"+o)).className="",e.classList.add("lyric-line"),e.style="",document.getElementById("line-"+o).classList.add("current-line-xrc"),Array.from(e.getElementsByTagName("span")).forEach(t=>{t.className="",t.style="background-clip: text"})}catch{console.error("error on #"+o)}}}catch(t){console.error("ERROR:"+t)}},syncLyric:function(){"lrc"==this.lyricMode?this.syncLyricLrc():this.clickedToSetCurrentTime||this.syncLyricXrc()},ending:function(){this.lyricTranslate?this.lastHasTwoLanguage=!0:this.lastHasTwoLanguage=!1,this.audio.currentTime=0,pipWindow.fill(" ",null);var t="order";switch(null!=localStorage.getItem("player_mode")?t=localStorage.getItem("player_mode"):localStorage.setItem("player_mode",t),t){case"order":this.playNext();break;case"reverse":this.playPrev();break;case"random":this.playRandom();break;case"loop":this.playAgain()}},all_played:function(){for(var t=this.playlist.children[0].children,o=0;o<t.length;o++)if("current-song-played"!=t[o].className&&"current-song"!=t[o].className)return!1;return!0},playNum:function(t){var o=this.playlist.children[0].children,n=this.currentIndex;this.currentIndex=t,this.setClass(n,this.currentIndex);t=o[this.currentIndex].children[0].getAttribute("data-name");window.location.hash=t,this.play(t)},playRandom:function(){var t,o=this.playlist.children[0].children,n=this.currentIndex,e=this.all_played();if(e)for(var a=0;a<o.length;a++)o[a].className="";for(;this.currentIndex=Math.floor(Math.random()*this.playlist.children[0].children.length),"current-song-played"==o[this.currentIndex].className||"current-song"==o[this.currentIndex].className;);t=o[this.currentIndex].children[0],this.setClass(e?-1:n,this.currentIndex);e=t.getAttribute("data-name");window.location.hash=e,this.play(e)},playAgain:function(){this.audio.currentTime=0,this.audio.play()},playNext:function(){var t=this.playlist.children[0].children,o=this.currentIndex,o=(this.currentIndex===t.length-1?this.currentIndex=0:this.currentIndex++,t=t[this.currentIndex].children[0],this.setClass(o,this.currentIndex),t.getAttribute("data-name"));window.location.hash=o,this.play(o)},playPrev:function(){var t=this.playlist.children[0].children,o=this.currentIndex,o=(0===this.currentIndex?this.currentIndex=t.length-1:--this.currentIndex,t=t[this.currentIndex].children[0],this.setClass(o,this.currentIndex),t.getAttribute("data-name"));window.location.hash=o,this.play(o)},setClass:function(t,o){var n=this.playlist.children[0].children;-1!=t&&(n[t].className="current-song-played"),n[o].className="current-song"},getOffset:function(t){var o=0;try{var n=t.match(/\[offset:\-?\+?\d+\]/g)[0].split(":")[1],o=parseInt(n)}catch(t){o=0}return o},download:function(t){t=t||this.currentIndex;var o=this.playlist.children[0].children,n=o[t].children[0].getAttribute("data-name"),e=document.createElement("a");e.href=`music/${n}.mp3`,e.download=o[t].children[0].textContent+".mp3",e.target="_blank",e.click()}},document.getElementById("spectrum-cvs")),ctx=cvs.getContext("2d"),audio=document.getElementById("audio");let analyser=null,dataArray=new Uint8Array(512);function initAudio(){let t=new AudioContext,o=t.createMediaElementSource(audio);(analyser=t.createAnalyser()).fftSize=512,dataArray=new Uint8Array(analyser.frequencyBinCount),draw(),o.connect(analyser),analyser.connect(t.destination)}function draw(){requestAnimationFrame(draw),ctx.clearRect(0,0,cvs.width,cvs.height),analyser.getByteFrequencyData(dataArray);var o=cvs.width/3;const n=ctx.createLinearGradient(0,0,cvs.width,0);n.addColorStop(0,"#00ffff"),n.addColorStop(1,"#ff1493");for(let t=0;t<o;t++){var e=dataArray[t]/255*cvs.height;drawRoundedRect(3*t,cvs.height-e,3,e,3),ctx.fillStyle=n,ctx.fill()}}function drawRoundedRect(t,o,n,e,a){ctx.beginPath(),ctx.moveTo(t+a,o),ctx.lineTo(t+n-a,o),ctx.arcTo(t+n,o,t+n,o+e,a),ctx.lineTo(t+n,o+e-a),ctx.arcTo(t+n,o+e,t+n-a,o+e,a),ctx.lineTo(t+a,o+e),ctx.arcTo(t,o+e,t,o+e-a,a),ctx.lineTo(t,o+a),ctx.arcTo(t,o,t+a,o,a),ctx.closePath(),ctx.lineWidth=1,ctx.strokeStyle="#000",ctx.stroke()}initAudio(),document.getElementById("audio").addEventListener("pause",function(){ctx.clearRect(0,0,cvs.width,cvs.height)});
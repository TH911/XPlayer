function responsiveDesign(t){var n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,i=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,o=document.getElementById("playlist"),e=document.getElementById("search-container");(n<i||n<800)&&(t&&(o.style.display="none"),e.style.display="none")}function playlist_hide(){var t,n,i=document.getElementById("playlist"),o=document.getElementById("button_search-container");"none"==i.style.display?(i.style.display="block",o.style.display="none",document.getElementById("search-container").style.display="none",document.getElementById("controls").style.display="none",t=document.getElementById("playlist_ol"),n=document.getElementById("playlist-"+PLAYER.currentIndex),t.scrollTo({top:Math.max(0,n.offsetTop-Math.floor(parseInt(i.clientHeight)/2)),behavior:"smooth"})):(i.style.display="none",o.style.display="block",document.getElementById("controls").style.display="block")}function initAudioEvent(i){var o=document.getElementsByTagName("audio")[i],t=document.getElementById("audioPlayer"+i),e=(o.addEventListener("loadedmetadata",function(){var t=PLAYER.duration;document.getElementById("audio-length-total").textContent=transTime(Math.ceil(t))}),o.addEventListener("timeupdate",function(){updateProgress(o,i)},!1),o.addEventListener("pause",function(){t.innerHTML='<path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="M6.271 5.055a.5.5 0 0 1 .52.038l3.5 2.5a.5.5 0 0 1 0 .814l-3.5 2.5A.5.5 0 0 1 6 10.5v-5a.5.5 0 0 1 .271-.445"/>'},!1),o.addEventListener("play",function(){t.innerHTML='<path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="M6 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5m4 0a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5"/>'},!1),t.addEventListener("click",function(){o.paused?o.play():o.pause()},!1),window.addEventListener("keydown",function(t){" "==t.key&&(o.paused?o.play():o.pause())},!1),document.getElementById("progressBarBg"+i));e.addEventListener("mousedown",function(t){var n;o.paused&&0==o.currentTime||(n=parseFloat(window.getComputedStyle(e,null).width.replace("px","")),t=t.offsetX/n,o.currentTime=PLAYER.duration*t,updateProgress(o,i))},!1),dragProgressDotEvent(o,i)}function dragProgressDotEvent(i,o){var n=document.getElementById("progressDot"+o),e={oriOffestLeft:0,oriX:0,maxLeft:0,maxRight:0},a=!1;function t(t){i.paused&&0==i.currentTime||(a=!0,e.oriOffestLeft=n.offsetLeft,e.oriX=(t.touches?t.touches[0]:t).clientX,e.maxLeft=e.oriOffestLeft,e.maxRight=document.getElementById("progressBarBg"+o).offsetWidth-e.oriOffestLeft,t&&t.preventDefault?t.preventDefault():t.returnValue=!1,t&&t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0)}function r(t){var n;a&&((t=(t.touches?t.touches[0]:t).clientX-e.oriX)>e.maxRight?t=e.maxRight:t<-e.maxLeft&&(t=-e.maxLeft),n=document.getElementById("progressBarBg"+o),n=parseFloat(window.getComputedStyle(n,null).width.replace("px","")),t=(e.oriOffestLeft+t)/n,i.currentTime=PLAYER.duration*t,updateProgress(i,o))}function c(){a=!1}n.addEventListener("mousedown",t,!1),n.addEventListener("touchstart",t,!1),document.addEventListener("mousemove",r,!1),document.addEventListener("touchmove",r,!1),document.addEventListener("mouseup",c,!1),document.addEventListener("touchend",c,!1)}function updateProgress(t,n){var i=t.currentTime/PLAYER.duration;document.getElementById("progressBar"+n).style.width=100*i+"%",document.getElementById("progressDot"+n).style.left=100*i+"%",document.getElementById("audioCurTime"+n).innerText=transTime(t.currentTime)}function transTime(t){var n=parseInt(t/3600),i=(t%=3600,parseInt(t/60)),t=parseInt(t%60);return formatTime(0<n?n+":"+i+":"+t:i+":"+t)}function formatTime(t){for(var n="",i=t.split(":"),o=0;o<i.length-1;o++)n=n+(1==i[o].length?"0"+i[o]:i[o])+":";return n+=1==i[o].length?"0"+i[o]:i[o]}responsiveDesign(!0),window.addEventListener("resize",function(){responsiveDesign(!0)}),document.addEventListener("DOMContentLoaded",function(){for(var t=document.querySelector(".audio-right"),t=window.getComputedStyle(t,null).width,n=(document.querySelector(".audio-right p").style.maxWidth=t,document.getElementsByTagName("audio")),i=0;i<n.length;i++)initAudioEvent(i)},!1);const searchBox=document.getElementById("search-box"),searchResults=document.getElementById("search-results");async function loadData(){try{var t=await loadJson();return(await JSON.parse(t)).data}catch(t){return console.error("failed to loading the search box of songs:",t),null}}var searchData=null;function getSearchData(){return searchData=null==searchData?loadData():searchData}async function searchSongs(t){if(t){const n=searchData=null==searchData?await getSearchData():searchData,i=t.toLowerCase(),o=n.filter(t=>t.song_name.toLowerCase().includes(i)||t.artist.toLowerCase().includes(i)||t.lrc_name.toLowerCase().includes(i)||t.album.toLowerCase().includes(i));searchResults.innerHTML=o.map(t=>`<li id='search-songs-${t.lrc_name}'><img src="./music/${t.lrc_name}.webp"><span><strong>${t.song_name}</strong> - ${t.artist}</span></li>`).join("")}else searchResults.innerHTML=""}function search_hide(){var t=document.getElementById("search-container");"none"==t.style.display?(t.style.display="block",document.getElementById("controls").style.display="none"):(t.style.display="none",document.getElementById("controls").style.display="block")}function playmode_change(t){null!=localStorage.getItem("player_mode")&&(document.getElementById("menu_"+localStorage.getItem("player_mode")).style.color="#999"),localStorage.setItem("player_mode",t),document.getElementById("menu_"+t).style.color="#fff"}function font_change(t){var n=localStorage.getItem("player_font"),i=(null!=n&&(document.getElementById("menu_font_"+n).style.color="#999"),localStorage.setItem("player_font",t),document.getElementById("menu_font_"+t).style.color="#fff",document.getElementById("lyricWrapper"));switch(i.style.fontFamily=t,pipWindowIsOpened&&(pipWindow.document.body.style.fontFamily=t),t){case"fordefault":case"youyuan":i.style.fontSize="16px";break;default:i.style.fontSize="18px"}}function hide_font(){var t=document.getElementById("menu-font");"none"==t.style.display?t.style.display="block":t.style.display="none"}function hide_playmode(){var t=document.getElementById("menu-playmode");"none"==t.style.display?t.style.display="block":t.style.display="none"}searchBox.addEventListener("input",t=>{searchSongs(t.target.value)}),searchResults.addEventListener("click",t=>{for(var n=t.target;"li"!=n.tagName.toLowerCase();)n=n.parentNode;document.getElementById("search-box").value="",document.getElementById("search-results").innerHTML="",responsiveDesign(),PLAYER.playNum(parseInt(n.id.substring(13))-1)}),document.addEventListener("keydown",function(t){" "===t.key&&t.preventDefault()}),$(document).ready(function(){$(".menu-title").click(function(){$(this).siblings(".menu-content").toggleClass("show")})});var pipWindow,PLAYER,pipWindowIsOpened=!1;async function pipWindowCreate(){if(pipWindow=await window.documentPictureInPicture.requestWindow({width:350,height:52}),pipWindowIsOpened=!0,pipWindow.addEventListener("resize",function(){pipWindowFillXrc(document.getElementById("line-"+PLAYER.lastXrcLetterI))}),pipWindow.document.addEventListener("keydown",function(t){"p"==t.key&&(pipWindowIsOpened=!1,pipWindow.close())," "==t.key&&(PLAYER.audio.paused?PLAYER.audio.play():PLAYER.audio.pause()),"ArrowUp"==t.code?PLAYER.playPrev():"ArrowDown"==t.code?PLAYER.playNext():"ArrowLeft"==t.code?PLAYER.audio.currentTime-=Math.min(PLAYER.audio.currentTime,10):"ArrowRight"==t.code&&(PLAYER.audio.currentTime+=10)}),pipWindow.addEventListener("beforeunload",function(){pipWindowIsOpened=!1}),pipWindow.addEventListener("click",function(){PLAYER.audio.paused?PLAYER.audio.play():PLAYER.audio.pause()}),console.log("pipWindow has created."),"lrc"==PLAYER.lyricMode)try{for(var t=0,n=PLAYER.lyric.length;t<=n;t++)if(t==n||PLAYER.audio.currentTime<=PLAYER.lyric[t][0]-.5){0<t&&t--,1<t&&PLAYER.lyric[t][0]==PLAYER.lyric[t-1][0]&&(t-=1);var i=null,o=PLAYER.lyric[t][1];t+1<n&&PLAYER.lyric[t][0]==PLAYER.lyric[t+1][0]&&(i=PLAYER.lyric[t+1][1]),0==o.length&&(o=" "),pipWindowIsOpened&&pipWindowFill(o,i);break}}catch(t){console.error("ERROR:"+t)}pipWindow.document.head.innerHTML=document.head.innerHTML;var e=document.createElement("link");e.innerHTML='<link rel="stylesheet" href="css/pipWindow.min.css">',pipWindow.document.head.appendChild(e),pipWindow.document.body.style.fontFamily=localStorage.getItem("player_font"),pipWindowFillXrc(document.getElementById("line-"+PLAYER.lastXrcLetterI))}function pipWindowFillTextLength(t){for(var n=0,i=0;i<t.length;i++){for(var o=!1,e=[" ",",",".","<",">",";",":",'"',"'","{","}","[","]","-","_","+","=","!","~","`","@","#","$","%","^","&","*","(",")","|","\\"],a=0;a<e.length;a++)if(t[i]==e[a]){o=!0;break}"a"<=t[i]&&t[i]<="z"||"A"<=t[i]&&t[i]<="Z"||o?n+=.5:n++}return n}async function pipWindowFill(t,n){var i,o=document.createElement("div"),e=(o.id="tool",o.textContent=t,o.style.fontFamily=localStorage.getItem("player_font"),o.style.textShadow="1px 0 0 #000, -1px 0 0 #000, 0 1px 0 #000, 0 -1px 0 #000",o.style.fontWeight="bolder",o.style.lineHeight=pipWindow.innerHeight+"px",o.style.margin="auto",pipWindowFillTextLength(t)),t=(o.style.fontSize=Math.min(Math.floor((pipWindow.innerWidth-40)/e),pipWindow.innerHeight-20)+"px",o.style.color=["#FAFA17","#ff1493","#adff2f","#d731f8","#00CC65"][PLAYER.lyricStyle],pipWindow.document.body.innerHTML="",pipWindow.addEventListener("resize",function(){var t=pipWindow.document.getElementById("tool");t.fontSize=Math.min(Math.floor((pipWindow.innerWidth-40)/t.textContent.length),pipWindow.innerHeight-20)+"px"}),o.style.textAlign="center",o.style.lineHeight=pipWindow.innerHeight+"px",null!=n&&(i=pipWindowFillTextLength(n),o.style.fontSize=Math.min(Math.min(Math.floor((pipWindow.innerWidth-40)/e),(pipWindow.innerHeight-20)/2),Math.min(Math.floor((pipWindow.innerWidth-40)/i),pipWindow.innerHeight-20))+"px",o.textContent=t+""+n,e=document.createElement("div"),i=document.createElement("div"),o.style.lineHeight=Math.floor(pipWindow.innerHeight/2)+"px",o.textContent="",e.textContent=t,i.textContent=n,i.style.color="#fff",o.appendChild(e),o.appendChild(i)),pipWindow.document.body.appendChild(o),PLAYER.audio_name[PLAYER.currentIndex+1]),n=PLAYER.audio_artist[PLAYER.currentIndex+1];pipWindow.document.body.title=t+" - "+n+" | XPlayer"}async function pipWindowFillXrc(t){pipWindow.document.body.classList.add("current-line-xrc-"+PLAYER.lyricStyle),pipWindow.document.body.innerHTML="";var n,i=t.cloneNode(2),t=(null==PLAYER.lyricTranslate?(n=pipWindow.innerHeight-20,i.style.fontSize=n+"px",Array.from(i.children).forEach(t=>{t.classList.add("lyricInline")}),i.style.lineHeight=pipWindow.innerHeight+"px",pipWindow.document.body.appendChild(i),pipWindow.document.body.style.height=pipWindow.innerHeight+"px"):(n=Math.floor((pipWindow.innerHeight-20)/2),i.style.fontSize=1.2*n+"px",Array.from(i.children).forEach(t=>{t.classList.add("lyricInline")}),i.style.lineHeight=Math.floor(pipWindow.innerHeight/2*1.2)+"px",pipWindow.document.body.appendChild(i),pipWindow.document.body.style.height=pipWindow.innerHeight+"px",o=document.createElement("br"),pipWindow.document.body.appendChild(o),(o=t.parentNode.nextElementSibling.getElementsByTagName("span")[0].cloneNode(2))&&"translateLyric"==o.className?(o.style.fontSize=.8*n+"px",o.style.lineHeight=Math.floor(pipWindow.innerHeight/2*.8)+"px",pipWindow.document.body.appendChild(o)):(pipWindow.document.body.classList.add("current-line-xrc-"+PLAYER.lyricStyle),pipWindow.document.body.innerHTML="",n=pipWindow.innerHeight-20,i.style.fontSize=n+"px",Array.from(i.children).forEach(t=>{t.classList.add("lyricInline")}),i.style.lineHeight=pipWindow.innerHeight+"px",pipWindow.document.body.appendChild(i),pipWindow.document.body.style.height=pipWindow.innerHeight+"px")),pipWindow.document.getElementById("line-"+PLAYER.lastXrcLetterI+"-"+PLAYER.lastXrcLetterJ)),o=t.offsetLeft+pipWindowFillTextLength(t.textContent)*n-pipWindow.innerWidth/2,i=(pipWindow.scrollTo({left:o}),PLAYER.audio_name[PLAYER.currentIndex+1]),t=PLAYER.audio_artist[PLAYER.currentIndex+1];pipWindow.document.body.title=i+" - "+t+" | XPlayer"}document.addEventListener("keydown",function(t){"p"==t.key&&("documentPictureInPicture"in window?pipWindowIsOpened?(pipWindowIsOpened=!1,pipWindow.close()):pipWindowCreate():console.error("pipWindow isn't supported."))}),window.onload=function(){var t=localStorage.getItem("player_mode"),t=(null==t&&(localStorage.setItem("player_mode","order"),t="order"),playmode_change(t),localStorage.getItem("player_font"));null==t&&(localStorage.setItem("player_font","fordefault"),t="fordefault"),font_change(t),(PLAYER=new Selected).init()};var mouseState="up",mouseStateTime=0,mouseTouchStart=!1,mouseInLyricContainer=!1;async function FetchJson(){console.log("fetch content.json.");var t=await(await fetch("json/content.json")).json(),t=JSON.stringify(t);localStorage.setItem("content.json",t)}async function loadJson(){var t=sessionStorage.getItem("counterForContent");return localStorage.getItem("content.json")?null==t&&(sessionStorage.setItem("counterForContent",1),FetchJson()):null==t&&await FetchJson(),localStorage.getItem("content.json")}function mainRGB(t){var n=document.createElement("canvas"),i=n.getContext("2d");n.width=t.width,n.height=t.height,i.drawImage(t,0,0);for(var o=i.getImageData(0,0,n.width,n.height).data,e={},a=0;a<o.length;a+=4)e[r=o[a]+","+o[a+1]+","+o[a+2]]||(e[r]={count:0,color:r}),e[r].count++;var r,c="",s=0;for(r in e)e[r].count>s&&(s=e[r].count,c=e[r].color);return"rgb("+c+")"}document.addEventListener("touchstart",function(){mouseStateTime=(new Date).getTime(),mouseState="down",mouseTouchStart=!0}),document.addEventListener("mousedown",function(){mouseStateTime=(new Date).getTime(),mouseState="down"}),document.addEventListener("mouseup",function(){mouseStateTime=(new Date).getTime(),mouseState="up"}),document.addEventListener("touchend",function(){mouseStateTime=(new Date).getTime(),mouseTouchStart=!(mouseState="up")}),document.getElementById("lyricWrapper").addEventListener("scroll",function(){mouseStateTime=(new Date).getTime(),mouseState="scroll"}),setInterval(function(){"scroll"==mouseState&&1500<(new Date).getTime()-mouseStateTime&&(mouseTouchStart||(mouseState="up"))},100);var Selected=function(){this.audio=document.getElementById("audio"),this.lyricContainer=document.getElementById("lyricContainer"),this.playlist=document.getElementById("playlist"),this.lyricWrapper=document.getElementById("lyricWrapper"),this.cover_img=document.getElementById("cover_img"),this.disapointer=document.getElementById("disapointer"),this.cover_disc=document.getElementById("cover_disc"),this.cover_disc_img=document.getElementById("cover_disc_img"),this.currentIndex=0,this.lyric=null,this.lyricStyle=0,this.lyricMode="lrc",this.clickedToSetCurrentTime=!1,this.last=-1,this.lastXrcLetterI=null,this.lastXrcLetterJ=null,this.lyricTranslate=null,this.lastHasTwoLanguage=!1,this.audio_name=[],this.audio_artist=[],this.audio_album=[],this.duration=0,this.audio_duration=[]},cvs=(Selected.prototype={constructor:Selected,init:async function(){await this.initialList();var t,a=this,n=this.playlist.children[0].children,i=window.location.hash.substring(1),i=1<=i&&i<=n.length?i:0,o=(this.currentIndex=i||Math.floor(Math.random()*n.length)+1,this.currentIndex=this.currentIndex-1,t=(i=n[this.currentIndex]).children[0].getAttribute("data-name"),window.location.hash=window.location.hash||t,this.playlist.addEventListener("click",function(t){var n,i;"a"==t.target.nodeName.toLowerCase()&&(n=a.playlist.children[0].children,n=Array.prototype.indexOf.call(n,t.target.parentNode),i=a.currentIndex,a.currentIndex=n,a.setClass(i,n),i=t.target.getAttribute("data-name"),window.location.hash=i,a.play(i))},!1),this.audio.onended=function(){a.ending()},this.audio.onerror=function(t){console.error("audio load error:"+t);t=sessionStorage.getItem("audioErrorCount");null==t&&(t=0),++t<=2?a.play(a.currentIndex+1):a.lyricContainer.textContent="歌曲加载失败,请检查网络或清空缓存并重试"},this.lyricContainer.addEventListener("click",t=>{if(!(this.lyric.length<=1)){t=t.target;if("span"==t.tagName.toLowerCase()){if("span"==t.parentNode.tagName.toLowerCase()&&(t=t.parentNode),"lrc"==a.lyricMode)return a.audio.currentTime=a.lyric[t.id.substring(5)][0],a.audio.play(),void("up"==mouseState&&a.lyricWrapper.scrollTo(0,line.offsetTop));console.log("lyric-mode:",t.getAttribute("lyric-mode"));try{if(a.lyric)for(var n=0;n<a.lyric.length;n++){var i=a.lyric[n];document.getElementById("line-"+n).className="";for(var o=0;o<i.length;o++){var e=document.getElementById("line-"+n+"-"+o);e.style.animationName="",e.style.animationDuration="",e.style.animationTimingFunction="",e.className=""}}}catch(t){console.error("ERROR:"+t)}"translate"==t.getAttribute("lyric-mode")?(a.audio.currentTime=t.getAttribute("start-time"),a.audio.play(),"up"==mouseState&&a.lyricWrapper.scrollTo(0,t.parentNode.previousSibling.offsetTop),console.log("change currentTime when click.(translateLyric)")):(a.audio.currentTime=t.getAttribute("start-time"),a.audio.play(),"up"==mouseState&&a.lyricWrapper.scrollTo(0,t.offsetTop),console.log("change currentTime when click.(normalLyric)"))}}}),window.addEventListener("keydown",function(t){var n;"ArrowUp"==t.code?a.playPrev():"ArrowDown"==t.code?a.playNext():"ArrowLeft"==t.code?(n=this.document.getElementById("audio")).currentTime-=Math.min(n.currentTime,10):"ArrowRight"==t.code&&((n=this.document.getElementById("audio")).currentTime+=10)},!1),localStorage.getItem("bgMode"));null==o&&(o="imageBg",localStorage.setItem("bgMode","imageBg")),document.getElementsByTagName("html")[0].className=o,document.getElementById("bg_dark").addEventListener("click",function(){document.getElementsByTagName("html")[0].className="colorBg",localStorage.setItem("bgMode","colorBg")}),document.getElementById("bg_pic").addEventListener("click",function(){document.getElementsByTagName("html")[0].className="imageBg",localStorage.setItem("bgMode","imageBg")});for(var e=n.length-1;0<=e;e--)n[e].className="";i.className="current-song",this.audio.addEventListener("timeupdate",function(){this.currentTime>a.duration&&a.ending(),a.syncLyric()}),this.audio.addEventListener("pause",function(){if("xrc"==a.lyricMode)try{null!=a.lastXrcLetterI&&(document.getElementById("line-"+a.lastXrcLetterI+"-"+a.lastXrcLetterJ).style.animationPlayState="paused",pipWindowIsOpened&&(pipWindow.document.getElementById("line-"+a.lastXrcLetterI+"-"+a.lastXrcLetterJ).style.animationPlayState="paused"))}catch(t){console.error("ERROR:"+t)}a.cover_img.classList.add("paused"),a.cover_disc.classList.add("paused"),a.cover_disc_img.classList.add("paused"),a.disapointer.classList.remove("rotate")}),this.audio.addEventListener("play",function(){if("xrc"==a.lyricMode)try{a.lastXrcLetterI&&(document.getElementById("line-"+a.lastXrcLetterI+"-"+a.lastXrcLetterJ).style.animationPlayState="running",pipWindowIsOpened&&(pipWindow.document.getElementById("line-"+a.lastXrcLetterI+"-"+a.lastXrcLetterJ).style.animationPlayState="paused"))}catch(t){console.error("ERROR:"+t)}a.cover_img.classList.remove("paused"),a.cover_disc.classList.remove("paused"),a.cover_disc_img.classList.remove("paused"),a.disapointer.classList.add("rotate")}),this.cover_img.addEventListener("click",function(){a.audio.paused?a.audio.play():a.audio.pause()}),console.log("inited.It's time to play the song now."),this.play(t)},initialList:async function(){var e=this,t=await loadJson(),a=document.createDocumentFragment(),t=JSON.parse(t).data,n=this.playlist.getElementsByTagName("ol")[0],a=document.createDocumentFragment();t.forEach(function(t,n,i){var o=document.createElement("li");(i=document.createElement("a")).href="javascript:void(0)",i.dataset.name=t.lrc_name,i.textContent=t.song_name+" - "+t.artist,e.audio_name[t.lrc_name]=t.song_name,e.audio_artist[t.lrc_name]=t.artist,e.audio_album[t.lrc_name]=t.album,e.audio_duration[t.lrc_name]=t.duration,o.appendChild(i),o.id="playlist-"+n,a.appendChild(o)}),n.appendChild(a)},mediaSessionAPI(t,n){var i=this;return"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:t,artist:n,artwork:[{src:i.cover_img.src}]}),navigator.mediaSession.setActionHandler("seekbackward",function(){i.audio.currentTime-=Math.min(10,audio.currentTime)}),navigator.mediaSession.setActionHandler("seekforward",function(){i.audio.currentTime+=Math.min(10,PLAYER.duration-audio.currentTime)}),navigator.mediaSession.setActionHandler("previoustrack",function(){i.playPrev()}),navigator.mediaSession.setActionHandler("nexttrack",function(){i.playNext()}),navigator.mediaSession.setActionHandler("play",function(){i.audio.play()}),navigator.mediaSession.setActionHandler("pause",function(){i.audio.pause()}),!0)},play:function(t){this.lyricTranslate=null,this.lastXrcLetterI=this.lastXrcLetterJ=null;var n=this,i=(this.lyricContainer.textContent="loading song...",this.audio.src="music/"+t+".mp3",this.cover_img.src="music/"+t+".webp",this.cover_disc_img.src="music/"+t+".webp",this.cover_img.classList.remove("rotate"),this.cover_disc.classList.remove("rotate"),this.cover_disc_img.classList.remove("rotate"),this.disapointer.classList.remove("playing"),this.disapointer.classList.remove("rotate"),this.cover_img.addEventListener("load",function(){this.style.borderColor=mainRGB(this),this.classList.add("rotate"),n.cover_disc.classList.add("rotate"),n.cover_disc_img.classList.add("rotate"),n.disapointer.classList.add("playing"),n.disapointer.classList.add("rotate")},{once:!0}),console.log("change the src."),this.audio.currentTime=0,this.audio.addEventListener("canplay",function(){n.audio.play(),n.getLyric(n.audio.src.replace(".mp3",""))},{once:!0}),this.audio.play(),document.getElementById("playlist_ol")),o=document.getElementById("playlist-"+PLAYER.currentIndex),i=(i.scrollTo({top:Math.max(0,Math.max(0,o.offsetTop-Math.floor(parseInt(this.playlist.clientHeight)/2))),behavior:"smooth"}),document.getElementById("songinfo_audio").textContent=this.playlist.getElementsByTagName("li")[t-1].textContent,document.title=document.getElementById("songinfo_audio").textContent+" | XPlayer",document.getElementById("songinfo_name").textContent=this.audio_name[t],document.getElementById("songinfo_artist").textContent="歌手: "+this.audio_artist[t],document.getElementById("songinfo_album").textContent="专辑: "+this.audio_album[t],this.duration=this.audio_duration[t],this.mediaSessionAPI(this.audio_name[this.currentIndex+1]," "),window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight);this.lyricContainer.style.top=Math.floor(.4*(i-100)),this.lyric=null,this.lyricStyle=4},getLyricFetch:async function(t){var n;try{const i=await fetch(t);n=0==i.ok?null:await i.text()}catch{}return n},getLyric:async function(t){this.lyricContainer.textContent="loading lyric...";var n=await this.getLyricFetch(t+".xrc");null!=n?(this.lyricMode="xrc",this.lyricTranslate=await this.getLyricFetch(t+"_ts.xrc")):(this.lyricMode="lrc",n=await this.getLyricFetch(t+".lrc")),this.lyric=this.parseLyric(n),this.appendLyric(this.lyric)},parseLyricLrc:function(t){for(var n=t.split("\n"),a=/\[\d{2}:\d{2}.\d{2}\]/g,r=[],c=this.getOffset(t);!a.test(n[0]);)n=n.slice(1);return 0==n[n.length-1].length&&n.pop(),n.forEach(function(t,n,i){var o=t.match(a),e=t.replace(a,"");o.forEach(function(t,n,i){t=t.slice(1,-1).split(":");r.push([60*parseInt(t[0],10)+parseFloat(t[1])+parseInt(c)/1e3,e])})}),r.sort(function(t,n){return t[0]-n[0]}),r},parseLyricXrc:function(t){var n=(new DOMParser).parseFromString(t,"text/xml");console.log(n);try{t=n.getElementsByTagName("Lyric_1")[0].getAttribute("LyricContent")}catch(t){console.error(t),alert(".xrc 歌词解析出错.\nfailed to load lyric.")}for(var i=[],o=0;o<t.length;o++)"["==t[o]&&0<o&&(i+="\n"),i+=t[o];if(!(t=i))return null;const e=t,a=e.split("\n").filter(t=>""!==t.trim()),u=[];return a.forEach(t=>{const n=t.match(/\[\s*-?\d+\s*,\s*-?\d+\s*\]/);if(n){const r=n.input.substring(n[0].length),c=[],s=[...r.matchAll(/\(\s*-?\d+\s*,\s*-?\d+\s*\)/g)];for(var i=0;i<s.length;i++){var o=r.substring(0<i?s[i-1].index+s[i-1][0].length:0,s[i].index),e=s[i][0].match(/-?\d+/g),a=parseInt(e[0])/1e3,e=(parseInt(e[0])+parseInt(e[1])-1)/1e3;c.push([o,a,e])}u.push(c)}}),u},parseLyric:function(t){return"lrc"==this.lyricMode?this.parseLyricLrc(t):this.parseLyricXrc(t)},appendLyricLrc:function(t){var n=this.lyricContainer,a=document.createDocumentFragment();this.lyricContainer.innerHTML="";t.forEach(function(t,n,i){var o=document.createElement("p"),e=document.createElement("span");e.id="line-"+n,e.textContent=t[1],e.style.backgroundClip="text",e.style.webkitBackgroundClip="text",o.appendChild(e),a.appendChild(o)}),n.appendChild(a)},appendLyricXrc:function(t){var n=!1,i=null;if(null!=this.lyricTranslate){n=!0,console.log("Translating lyrics is available.");for(var i=this.parseLyricLrc(this.lyricTranslate),o=0,e=0;o<i.length;o++)"//\r"!=i[o][1]&&"\r"!=i[o][1]&&"//"!=i[o][1]&&""!=i[o][1]&&(i[e++]=i[o]);i.length=e,console.log(i),console.log(t)}var a=this.lyricContainer,r=document.createDocumentFragment(),c=0;this.lyricContainer.innerHTML="";for(o=0;o<t.length;o++){var s=document.createElement("p"),u=document.createElement("span");u.id="line-"+o,u.setAttribute("start-time",t[o][0][1]),u.setAttribute("lyric-mode","normal"),u.setAttribute("word","");for(e=0;e<t[o].length;e++){var d=document.createElement("span");d.style.backgroundClip="text",d.style.webkitBackgroundClip="text",d.id=u.id+"-"+e,d.textContent=t[o][e][0],u.setAttribute("word",u.getAttribute("word")+d.textContent),u.appendChild(d)}s.appendChild(u),r.appendChild(s),n&&c<i.length&&Math.abs(t[o][0][1]-i[c][0])<=1&&(s=document.createElement("p"),(u=document.createElement("span")).textContent=i[c++][1],u.classList.add("translateLyric"),u.setAttribute("start-time",t[o][0][1]),u.setAttribute("lyric-mode","translate"),s.appendChild(u),r.appendChild(s))}a.appendChild(r)},appendLyric:function(t){"lrc"==this.lyricMode?this.appendLyricLrc(t):this.appendLyricXrc(t)},syncLyricLrc:function(){this.lyricContainer.className="";try{if(!this.lyric)return;for(var t=0,n=this.lyric.length;t<=n;t++){if(t==n||this.audio.currentTime<=this.lyric[t][0]-.5){0<t&&t--,1<t&&this.lyric[t][0]==this.lyric[t-1][0]&&t--,(e=document.getElementById("line-"+t)).className="current-line-"+this.lyricStyle,t!=this.last&&(this.last=t,"up"==mouseState&&this.lyricWrapper.scrollTo(0,e.offsetTop));var i=null,o=this.lyric[t][1];t+1<n&&this.lyric[t][0]==this.lyric[t+1][0]&&(i=this.lyric[t+1][1]),0==o.length&&(o=" "),this.mediaSessionAPI(this.audio_name[this.currentIndex+1],o),pipWindowIsOpened&&pipWindowFill(o,i);for(var e,a=t+1;a<n;a++)(e=document.getElementById("line-"+a)).className="";break}try{(e=document.getElementById("line-"+t)).className=""}catch{console.error("error on #"+t)}}}catch(t){console.error("ERROR:"+t)}},syncLyricXrc:function(){this.lyricContainer.classList.add("current-line-xrc-"+this.lyricStyle);try{if(!this.lyric)return;for(var t=this.audio.currentTime+.25,n=0;n<this.lyric.length;n++){var i=this.lyric[n];if(t<=i[i.length-1][2]+.25){(o=document.getElementById("line-"+n)).classList.add("current-line"),n!=this.last&&("up"==mouseState&&this.lyricWrapper.scrollTo(0,o.offsetTop),this.last=n),t<i[0][1]?this.mediaSessionAPI(this.audio_name[this.currentIndex+1]," "):this.mediaSessionAPI(this.audio_name[this.currentIndex+1],o.getAttribute("word"));for(var o,e=0;e<i.length;e++){var a=document.getElementById("line-"+n+"-"+e);if(!(t>i[e][2])){if(t<i[e][1])break;a.classList.add("current-line-xrc-playing-"+this.lyricStyle),this.lastXrcLetterI==n&&this.lastXrcLetterJ==e||(a.style.animationName="lyric_sync_letter",a.style.animationTimingFunction="linear",a.style.animationDuration=i[e][2]-i[e][1]+"s",this.lastXrcLetterI=n,this.lastXrcLetterJ=e,pipWindowIsOpened&&pipWindowFillXrc(document.getElementById("line-"+this.lastXrcLetterI)));break}a.classList.add("current-line-xrc-played-"+this.lyricStyle),a.classList.remove("current-line-xrc-playing-"+this.lyricStyle)}for(n++;n<this.lyric.length;n++)try{(o=document.getElementById("line-"+n)).className="",document.getElementById("line-"+n).classList.add("current-line-xrc"),o.style="",Array.from(o.getElementsByTagName("span")).forEach(t=>{t.className="",t.style="background-clip: text"})}catch{console.error("error on #"+e)}break}try{(o=document.getElementById("line-"+n)).className="",o.style="",document.getElementById("line-"+n).classList.add("current-line-xrc"),Array.from(o.getElementsByTagName("span")).forEach(t=>{t.className="",t.style="background-clip: text"})}catch{console.error("error on #"+n)}}}catch(t){console.error("ERROR:"+t)}},syncLyric:function(){"lrc"==this.lyricMode?this.syncLyricLrc():this.clickedToSetCurrentTime||this.syncLyricXrc()},ending:function(){this.lyricTranslate?this.lastHasTwoLanguage=!0:this.lastHasTwoLanguage=!1,this.audio.currentTime=0,pipWindowIsOpened&&pipWindowFill(" ",null);var t="order";switch(null!=localStorage.getItem("player_mode")?t=localStorage.getItem("player_mode"):localStorage.setItem("player_mode",t),t){case"order":this.playNext();break;case"reverse":this.playPrev();break;case"random":this.playRandom();break;case"loop":this.playAgain()}},all_played:function(){for(var t=this.playlist.children[0].children,n=0;n<t.length;n++)if("current-song-played"!=t[n].className&&"current-song"!=t[n].className)return!1;return!0},playNum:function(t){var n=this.playlist.children[0].children,i=this.currentIndex;this.currentIndex=t,this.setClass(i,this.currentIndex);t=n[this.currentIndex].children[0].getAttribute("data-name");window.location.hash=t,this.play(t)},playRandom:function(){var t,n=this.playlist.children[0].children,i=this.currentIndex,o=this.all_played();if(o)for(var e=0;e<n.length;e++)n[e].className="";for(;this.currentIndex=Math.floor(Math.random()*this.playlist.children[0].children.length),"current-song-played"==n[this.currentIndex].className||"current-song"==n[this.currentIndex].className;);t=n[this.currentIndex].children[0],this.setClass(o?-1:i,this.currentIndex);o=t.getAttribute("data-name");window.location.hash=o,this.play(o)},playAgain:function(){this.audio.currentTime=0,this.audio.play()},playNext:function(){var t=this.playlist.children[0].children,n=this.currentIndex,n=(this.currentIndex===t.length-1?this.currentIndex=0:this.currentIndex++,t=t[this.currentIndex].children[0],this.setClass(n,this.currentIndex),t.getAttribute("data-name"));window.location.hash=n,this.play(n)},playPrev:function(){var t=this.playlist.children[0].children,n=this.currentIndex,n=(0===this.currentIndex?this.currentIndex=t.length-1:--this.currentIndex,t=t[this.currentIndex].children[0],this.setClass(n,this.currentIndex),t.getAttribute("data-name"));window.location.hash=n,this.play(n)},setClass:function(t,n){var i=this.playlist.children[0].children;-1!=t&&(i[t].className="current-song-played"),i[n].className="current-song"},getOffset:function(t){var n=0;try{var i=t.match(/\[offset:\-?\+?\d+\]/g)[0].split(":")[1],n=parseInt(i)}catch(t){n=0}return n}},document.getElementById("spectrum-cvs")),ctx=cvs.getContext("2d"),audio=document.getElementById("audio");let analyser=null,dataArray=new Uint8Array(512);function initAudio(){let t=new AudioContext,n=t.createMediaElementSource(audio);(analyser=t.createAnalyser()).fftSize=512,dataArray=new Uint8Array(analyser.frequencyBinCount),draw(),n.connect(analyser),analyser.connect(t.destination)}function draw(){requestAnimationFrame(draw),ctx.clearRect(0,0,cvs.width,cvs.height),analyser.getByteFrequencyData(dataArray);var n=cvs.width/3;const i=ctx.createLinearGradient(0,0,cvs.width,0);i.addColorStop(0,"#00ffff"),i.addColorStop(1,"#ff1493");for(let t=0;t<n;t++){var o=dataArray[t]/255*cvs.height;drawRoundedRect(3*t,cvs.height-o,3,o,3),ctx.fillStyle=i,ctx.fill()}}function drawRoundedRect(t,n,i,o,e){ctx.beginPath(),ctx.moveTo(t+e,n),ctx.lineTo(t+i-e,n),ctx.arcTo(t+i,n,t+i,n+o,e),ctx.lineTo(t+i,n+o-e),ctx.arcTo(t+i,n+o,t+i-e,n+o,e),ctx.lineTo(t+e,n+o),ctx.arcTo(t,n+o,t,n+o-e,e),ctx.lineTo(t,n+e),ctx.arcTo(t,n,t+e,n,e),ctx.closePath(),ctx.lineWidth=1,ctx.strokeStyle="#000",ctx.stroke()}initAudio(),document.getElementById("audio").addEventListener("pause",function(){ctx.clearRect(0,0,cvs.width,cvs.height)});
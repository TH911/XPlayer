function responsiveDesign(n){var t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,o=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,e=document.getElementById("playlist"),i=document.getElementById("search-container");(t<o||t<800)&&(n&&(e.style.display="none"),i.style.display="none")}function playlist_hide(){var n,t,o,e=document.getElementById("playlist"),i=document.getElementById("button_search-container");"none"==e.style.display?(e.style.display="block",i.style.display="none",document.getElementById("search-container").style.display="none",document.getElementById("controls").style.display="none",n=document.getElementById("playlist_ol"),t=document.getElementById("playlist-"+PLAYER.currentIndex),o=e.style.height.split("px")[0],n.scrollTop=Math.max(0,t.offsetTop-Math.floor(parseInt(o)/2))):(e.style.display="none",i.style.display="block",document.getElementById("controls").style.display="block")}function initAudioEvent(o){var e=document.getElementsByTagName("audio")[o],n=document.getElementById("audioPlayer"+o),i=(e.addEventListener("loadedmetadata",function(){var n=PLAYER.duration;document.getElementById("audio-length-total").textContent=transTime(Math.ceil(n))}),e.addEventListener("timeupdate",function(){updateProgress(e,o)},!1),e.addEventListener("pause",function(){n.src="data:image/png;base64,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"},!1),e.addEventListener("play",function(){n.src="data:image/png;base64,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"},!1),n.addEventListener("click",function(){e.paused?e.play():e.pause()},!1),window.addEventListener("keydown",function(n){" "==n.key&&(e.paused?e.play():e.pause())},!1),document.getElementById("progressBarBg"+o));i.addEventListener("mousedown",function(n){var t;e.paused&&0==e.currentTime||(t=parseFloat(window.getComputedStyle(i,null).width.replace("px","")),n=n.offsetX/t,e.currentTime=PLAYER.duration*n,updateProgress(e,o))},!1),dragProgressDotEvent(e,o)}function dragProgressDotEvent(o,e){var t=document.getElementById("progressDot"+e),i={oriOffestLeft:0,oriX:0,maxLeft:0,maxRight:0},a=!1;function n(n){o.paused&&0==o.currentTime||(a=!0,i.oriOffestLeft=t.offsetLeft,i.oriX=(n.touches?n.touches[0]:n).clientX,i.maxLeft=i.oriOffestLeft,i.maxRight=document.getElementById("progressBarBg"+e).offsetWidth-i.oriOffestLeft,n&&n.preventDefault?n.preventDefault():n.returnValue=!1,n&&n.stopPropagation?n.stopPropagation():window.event.cancelBubble=!0)}function r(n){var t;a&&((n=(n.touches?n.touches[0]:n).clientX-i.oriX)>i.maxRight?n=i.maxRight:n<-i.maxLeft&&(n=-i.maxLeft),t=document.getElementById("progressBarBg"+e),t=parseFloat(window.getComputedStyle(t,null).width.replace("px","")),n=(i.oriOffestLeft+n)/t,o.currentTime=PLAYER.duration*n,updateProgress(o,e))}function s(){a=!1}t.addEventListener("mousedown",n,!1),t.addEventListener("touchstart",n,!1),document.addEventListener("mousemove",r,!1),document.addEventListener("touchmove",r,!1),document.addEventListener("mouseup",s,!1),document.addEventListener("touchend",s,!1)}function updateProgress(n,t){var o=n.currentTime/PLAYER.duration;document.getElementById("progressBar"+t).style.width=100*o+"%",document.getElementById("progressDot"+t).style.left=100*o+"%",document.getElementById("audioCurTime"+t).innerText=transTime(n.currentTime)}function transTime(n){var t=parseInt(n/3600),o=(n%=3600,parseInt(n/60)),n=parseInt(n%60);return formatTime(0<t?t+":"+o+":"+n:o+":"+n)}function formatTime(n){for(var t="",o=n.split(":"),e=0;e<o.length-1;e++)t=t+(1==o[e].length?"0"+o[e]:o[e])+":";return t+=1==o[e].length?"0"+o[e]:o[e]}responsiveDesign(!0),window.addEventListener("resize",function(){responsiveDesign(!0)}),document.addEventListener("DOMContentLoaded",function(){for(var n=document.querySelector(".audio-right"),n=window.getComputedStyle(n,null).width,t=(document.querySelector(".audio-right p").style.maxWidth=n,document.getElementsByTagName("audio")),o=0;o<t.length;o++)initAudioEvent(o)},!1);const searchBox=document.getElementById("search-box"),searchResults=document.getElementById("search-results");async function loadData(){try{var n=await loadJson();return(await JSON.parse(n)).data}catch(n){return console.error("failed to loading the search box of songs:",n),null}}var searchData=null;function getSearchData(){return searchData=null==searchData?loadData():searchData}async function searchSongs(n){if(n){const t=searchData=null==searchData?await getSearchData():searchData,o=n.toLowerCase(),e=t.filter(n=>n.song_name.toLowerCase().includes(o)||n.artist.toLowerCase().includes(o)||n.lrc_name.toLowerCase().includes(o)||n.album.toLowerCase().includes(o));searchResults.innerHTML=e.map(n=>`<li id='search-songs-${n.lrc_name}'><img src="./music/${n.lrc_name}.webp"><span><strong>${n.song_name}</strong> - ${n.artist}</span></li>`).join("")}else searchResults.innerHTML=""}function search_hide(){var n=document.getElementById("search-container");"none"==n.style.display?(n.style.display="block",document.getElementById("controls").style.display="none"):(n.style.display="none",document.getElementById("controls").style.display="block")}function playmode_change(n){null!=localStorage.getItem("player_mode")&&(document.getElementById("menu_"+localStorage.getItem("player_mode")).style.color="#999"),localStorage.setItem("player_mode",n),document.getElementById("menu_"+n).style.color="#fff"}function font_change(n){var t=localStorage.getItem("player_font"),o=(null!=t&&(document.getElementById("menu_font_"+t).style.color="#999"),localStorage.setItem("player_font",n),document.getElementById("menu_font_"+n).style.color="#fff",document.getElementById("lyricWrapper"));switch(o.style.fontFamily=n,pipWindowIsOpened&&(pipWindow.document.body.style.fontFamily=n),n){case"fordefault":case"youyuan":o.style.fontSize="16px";break;default:o.style.fontSize="18px"}}function hide_font(){var n=document.getElementById("menu-font");"none"==n.style.display?n.style.display="block":n.style.display="none"}function hide_playmode(){var n=document.getElementById("menu-playmode");"none"==n.style.display?n.style.display="block":n.style.display="none"}searchBox.addEventListener("input",n=>{searchSongs(n.target.value)}),searchResults.addEventListener("click",n=>{const t=n.target;"li"===t.tagName.toLowerCase()&&(document.getElementById("search-box").value="",document.getElementById("search-results").innerHTML="",responsiveDesign(),PLAYER.playNum(parseInt(t.id.substring(13))-1))}),document.addEventListener("keydown",function(n){" "===n.key&&n.preventDefault()}),$(document).ready(function(){$(".menu-title").click(function(){$(this).siblings(".menu-content").toggleClass("show")})});var pipWindow,PLAYER,pipWindowIsOpened=!1;async function pipWindowCreate(){if(pipWindow=await window.documentPictureInPicture.requestWindow({width:350,height:52}),pipWindowIsOpened=!0,pipWindow.addEventListener("resize",function(){pipWindowFillXrc(document.getElementById("line-"+PLAYER.lastXrcLetterI))}),pipWindow.document.addEventListener("keydown",function(n){"p"==n.key&&(pipWindowIsOpened=!1,pipWindow.close())," "==n.key&&(PLAYER.audio.paused?PLAYER.audio.play():PLAYER.audio.pause()),"ArrowUp"==n.code?PLAYER.playPrev():"ArrowDown"==n.code?PLAYER.playNext():"ArrowLeft"==n.code?PLAYER.audio.currentTime-=Math.min(PLAYER.audio.currentTime,10):"ArrowRight"==n.code&&(PLAYER.audio.currentTime+=10)}),pipWindow.addEventListener("beforeunload",function(){pipWindowIsOpened=!1}),pipWindow.addEventListener("click",function(){PLAYER.audio.paused?PLAYER.audio.play():PLAYER.audio.pause()}),console.log("pipWindow has created."),"lrc"==PLAYER.lyricMode)try{for(var n=0,t=PLAYER.lyric.length;n<=t;n++)if(n==t||PLAYER.audio.currentTime<=PLAYER.lyric[n][0]-.5){0<n&&n--,1<n&&PLAYER.lyric[n][0]==PLAYER.lyric[n-1][0]&&(n-=1);var o=null,e=PLAYER.lyric[n][1];n+1<t&&PLAYER.lyric[n][0]==PLAYER.lyric[n+1][0]&&(o=PLAYER.lyric[n+1][1]),0==e.length&&(e=" "),pipWindowIsOpened&&pipWindowFill(e,o);break}}catch(n){console.error("ERROR:"+n)}pipWindow.document.head.innerHTML=document.head.innerHTML;var i=document.createElement("link");i.innerHTML='<link rel="stylesheet" href="css/pipWindow.min.css">',pipWindow.document.head.appendChild(i),pipWindow.document.body.style.fontFamily=localStorage.getItem("player_font"),pipWindowFillXrc(document.getElementById("line-"+PLAYER.lastXrcLetterI))}function pipWindowFillTextLength(n){for(var t=0,o=0;o<n.length;o++){for(var e=!1,i=[" ",",",".","<",">",";",":",'"',"'","{","}","[","]","-","_","+","=","!","~","`","@","#","$","%","^","&","*","(",")","|","\\"],a=0;a<i.length;a++)if(n[o]==i[a]){e=!0;break}"a"<=n[o]&&n[o]<="z"||"A"<=n[o]&&n[o]<="Z"||e?t+=.5:t++}return t}async function pipWindowFill(n,t){var o,e=document.createElement("div"),i=(e.id="tool",e.textContent=n,e.style.fontFamily=localStorage.getItem("player_font"),e.style.textShadow="1px 0 0 #000, -1px 0 0 #000, 0 1px 0 #000, 0 -1px 0 #000",e.style.fontWeight="bolder",e.style.lineHeight=pipWindow.innerHeight+"px",e.style.margin="auto",pipWindowFillTextLength(n)),n=(e.style.fontSize=Math.min(Math.floor((pipWindow.innerWidth-40)/i),pipWindow.innerHeight-20)+"px",e.style.color=["#FAFA17","#ff1493","#adff2f","#d731f8","#00CC65"][PLAYER.lyricStyle],pipWindow.document.body.innerHTML="",pipWindow.addEventListener("resize",function(){var n=pipWindow.document.getElementById("tool");n.fontSize=Math.min(Math.floor((pipWindow.innerWidth-40)/n.textContent.length),pipWindow.innerHeight-20)+"px"}),e.style.textAlign="center",e.style.lineHeight=pipWindow.innerHeight+"px",null!=t&&(o=pipWindowFillTextLength(t),e.style.fontSize=Math.min(Math.min(Math.floor((pipWindow.innerWidth-40)/i),(pipWindow.innerHeight-20)/2),Math.min(Math.floor((pipWindow.innerWidth-40)/o),pipWindow.innerHeight-20))+"px",e.textContent=n+""+t,i=document.createElement("div"),o=document.createElement("div"),e.style.lineHeight=Math.floor(pipWindow.innerHeight/2)+"px",e.textContent="",i.textContent=n,o.textContent=t,o.style.color="#fff",e.appendChild(i),e.appendChild(o)),pipWindow.document.body.appendChild(e),PLAYER.audio_name[PLAYER.currentIndex+1]),t=PLAYER.audio_artist[PLAYER.currentIndex+1];pipWindow.document.body.title=n+" - "+t+" | XPlayer"}async function pipWindowFillXrc(n){pipWindow.document.body.classList.add("current-line-xrc-"+PLAYER.lyricStyle),pipWindow.document.body.innerHTML="";var t,o=n.cloneNode(2),n=(null==PLAYER.lyricTranslate?(t=pipWindow.innerHeight-20,o.style.fontSize=t+"px",Array.from(o.children).forEach(n=>{n.classList.add("lyricInline")}),o.style.lineHeight=pipWindow.innerHeight+"px",pipWindow.document.body.appendChild(o),pipWindow.document.body.style.height=pipWindow.innerHeight+"px"):(t=Math.floor((pipWindow.innerHeight-20)/2),o.style.fontSize=1.2*t+"px",Array.from(o.children).forEach(n=>{n.classList.add("lyricInline")}),o.style.lineHeight=Math.floor(pipWindow.innerHeight/2*1.2)+"px",pipWindow.document.body.appendChild(o),pipWindow.document.body.style.height=pipWindow.innerHeight+"px",e=document.createElement("br"),pipWindow.document.body.appendChild(e),(e=n.parentNode.nextElementSibling.getElementsByTagName("span")[0].cloneNode(2))&&"translateLyric"==e.className?(e.style.fontSize=.8*t+"px",e.style.lineHeight=Math.floor(pipWindow.innerHeight/2*.8)+"px",pipWindow.document.body.appendChild(e)):(pipWindow.document.body.classList.add("current-line-xrc-"+PLAYER.lyricStyle),pipWindow.document.body.innerHTML="",t=pipWindow.innerHeight-20,o.style.fontSize=t+"px",Array.from(o.children).forEach(n=>{n.classList.add("lyricInline")}),o.style.lineHeight=pipWindow.innerHeight+"px",pipWindow.document.body.appendChild(o),pipWindow.document.body.style.height=pipWindow.innerHeight+"px")),pipWindow.document.getElementById("line-"+PLAYER.lastXrcLetterI+"-"+PLAYER.lastXrcLetterJ)),e=n.offsetLeft+pipWindowFillTextLength(n.textContent)*t-pipWindow.innerWidth/2,o=(pipWindow.scrollTo({left:e}),PLAYER.audio_name[PLAYER.currentIndex+1]),n=PLAYER.audio_artist[PLAYER.currentIndex+1];pipWindow.document.body.title=o+" - "+n+" | XPlayer"}document.addEventListener("keydown",function(n){"p"==n.key&&("documentPictureInPicture"in window?pipWindowIsOpened?(pipWindowIsOpened=!1,pipWindow.close()):pipWindowCreate():console.error("pipWindow isn't supported."))}),window.onload=function(){var n=localStorage.getItem("player_mode"),n=(null==n&&(localStorage.setItem("player_mode","order"),n="order"),playmode_change(n),localStorage.getItem("player_font"));null==n&&(localStorage.setItem("player_font","fordefault"),n="fordefault"),font_change(n),(PLAYER=new Selected).init()};var mouseState="up",mouseStateTime=0,mouseTouchStart=!1,mouseInLyricContainer=!1;async function FetchJson(){console.log("fetch content.json.");var n=await(await fetch("json/content.json")).json(),n=JSON.stringify(n);localStorage.setItem("content.json",n)}async function loadJson(){var n=sessionStorage.getItem("counterForContent");return localStorage.getItem("content.json")?null==n&&(sessionStorage.setItem("counterForContent",1),FetchJson()):null==n&&await FetchJson(),localStorage.getItem("content.json")}document.addEventListener("touchstart",function(){mouseStateTime=(new Date).getTime(),mouseState="down",mouseTouchStart=!0}),document.addEventListener("mousedown",function(){mouseStateTime=(new Date).getTime(),mouseState="down"}),document.addEventListener("mouseup",function(){mouseStateTime=(new Date).getTime(),mouseState="up"}),document.addEventListener("touchend",function(){mouseStateTime=(new Date).getTime(),mouseTouchStart=!(mouseState="up")}),document.getElementById("lyricWrapper").addEventListener("scroll",function(){mouseStateTime=(new Date).getTime(),mouseState="scroll"}),setInterval(function(){"scroll"==mouseState&&1500<(new Date).getTime()-mouseStateTime&&(mouseTouchStart||(mouseState="up"))},100);var Selected=function(){this.audio=document.getElementById("audio"),this.lyricContainer=document.getElementById("lyricContainer"),this.playlist=document.getElementById("playlist"),this.currentIndex=0,this.lyric=null,this.lyricStyle=0,this.lyricMode="lrc",this.clickedToSetCurrentTime=!1,this.last=-1,this.lastXrcLetterI=null,this.lastXrcLetterJ=null,this.lyricTranslate=null,this.lastHasTwoLanguage=!1,this.audio_name=[],this.audio_artist=[],this.audio_album=[],this.duration=0,this.audio_duration=[]},cvs=(Selected.prototype={constructor:Selected,init:async function(){await this.initialList();var n,e=this,t=this.playlist.children[0].children,o=window.location.hash.substring(1),o=1<=o&&o<=t.length?o:0,i=(this.currentIndex=o||Math.floor(Math.random()*t.length)+1,this.currentIndex=this.currentIndex-1,n=(o=t[this.currentIndex]).children[0].getAttribute("data-name"),window.location.hash=window.location.hash||n,this.playlist.addEventListener("click",function(n){var t,o;"a"==n.target.nodeName.toLowerCase()&&(t=e.playlist.children[0].children,t=Array.prototype.indexOf.call(t,n.target.parentNode),o=e.currentIndex,e.currentIndex=t,e.setClass(o,t),o=n.target.getAttribute("data-name"),window.location.hash=o,e.play(o))},!1),this.audio.onended=function(){e.ending()},this.audio.onerror=function(n){console.error("audio load error:"+n);n=sessionStorage.getItem("audioErrorCount");null==n&&(n=0),++n<=2?e.play(e.currentIndex+1):e.lyricContainer.textContent="歌曲加载失败,请检查网络或清空缓存并重试"},window.addEventListener("keydown",function(n){var t;"ArrowUp"==n.code?e.playPrev():"ArrowDown"==n.code?e.playNext():"ArrowLeft"==n.code?(t=this.document.getElementById("audio")).currentTime-=Math.min(t.currentTime,10):"ArrowRight"==n.code&&((t=this.document.getElementById("audio")).currentTime+=10)},!1),localStorage.getItem("bgMode"));null==i&&(i="imageBg",localStorage.setItem("bgMode","imageBg")),document.getElementsByTagName("html")[0].className=i,document.getElementById("bg_dark").addEventListener("click",function(){document.getElementsByTagName("html")[0].className="colorBg",localStorage.setItem("bgMode","colorBg")}),document.getElementById("bg_pic").addEventListener("click",function(){document.getElementsByTagName("html")[0].className="imageBg",localStorage.setItem("bgMode","imageBg")});for(var a=t.length-1;0<=a;a--)t[a].className="";o.className="current-song",this.audio.addEventListener("timeupdate",function(){e.syncLyric()}),this.audio.addEventListener("pause",function(){try{null!=e.lastXrcLetterI&&(document.getElementById("line-"+e.lastXrcLetterI+"-"+e.lastXrcLetterJ).style.animationPlayState="paused",pipWindowIsOpened&&(pipWindow.document.getElementById("line-"+e.lastXrcLetterI+"-"+e.lastXrcLetterJ).style.animationPlayState="paused"))}catch(n){console.error("ERROR:"+n)}}),this.audio.addEventListener("play",function(){try{e.lastXrcLetterI&&(document.getElementById("line-"+e.lastXrcLetterI+"-"+e.lastXrcLetterJ).style.animationPlayState="running",pipWindowIsOpened&&(pipWindow.document.getElementById("line-"+e.lastXrcLetterI+"-"+e.lastXrcLetterJ).style.animationPlayState="paused"))}catch(n){console.error("ERROR:"+n)}}),console.log("inited.It's time to play the song now."),this.play(n)},initialList:async function(){var i=this,n=await loadJson(),a=document.createDocumentFragment(),n=JSON.parse(n).data,t=this.playlist.getElementsByTagName("ol")[0],a=document.createDocumentFragment();n.forEach(function(n,t,o){var e=document.createElement("li");(o=document.createElement("a")).href="javascript:void(0)",o.dataset.name=n.lrc_name,o.textContent=n.song_name+" - "+n.artist,i.audio_name[n.lrc_name]=n.song_name,i.audio_artist[n.lrc_name]=n.artist,i.audio_album[n.lrc_name]=n.album,i.audio_duration[n.lrc_name]=n.duration,e.appendChild(o),e.id="playlist-"+t,a.appendChild(e)}),t.appendChild(a)},mediaSessionAPI(n,t){var o=this;return"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:n,artist:t,artwork:[{src:document.getElementById("cover_img").src}]}),navigator.mediaSession.setActionHandler("seekbackward",function(){o.audio.currentTime-=Math.min(10,audio.currentTime)}),navigator.mediaSession.setActionHandler("seekforward",function(){o.audio.currentTime+=Math.min(10,PLAYER.duration-audio.currentTime)}),navigator.mediaSession.setActionHandler("previoustrack",function(){o.playPrev()}),navigator.mediaSession.setActionHandler("nexttrack",function(){o.playNext()}),navigator.mediaSession.setActionHandler("play",function(){o.audio.play()}),navigator.mediaSession.setActionHandler("pause",function(){o.audio.pause()}),!0)},play:function(n){this.lyricTranslate=null,this.lastXrcLetterI=this.lastXrcLetterJ=null;var t=this,o=(this.lyricContainer.textContent="loading song...",this.audio.src="./music/"+n+".mp3",this.audio.currentTime=0,this.audio.addEventListener("canplay",function(){t.audio.play(),t.getLyric(t.audio.src.replace(".mp3",""))},{once:!0}),this.audio.play(),document.getElementById("playlist_ol")),e=document.getElementById("playlist-"+PLAYER.currentIndex),i=playlist.style.height.split("px")[0],o=(o.scrollTop=Math.max(0,e.offsetTop-Math.floor(parseInt(i)/2)),document.getElementById("songinfo_audio").textContent=this.playlist.getElementsByTagName("li")[n-1].textContent,document.title=document.getElementById("songinfo_audio").textContent+" | XPlayer",document.getElementById("cover_img").src="./music/"+n+".webp",document.getElementById("songinfo_name").textContent=this.audio_name[n],document.getElementById("songinfo_artist").textContent="歌手: "+this.audio_artist[n],document.getElementById("songinfo_album").textContent="专辑: "+this.audio_album[n],this.duration=this.audio_duration[n],sessionStorage.setItem("audio_name",this.audio_name[n]),this.mediaSessionAPI(sessionStorage.getItem("audio_name")," "),window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight);this.lyricContainer.style.top=Math.floor(.4*(o-100)),this.lyric=null,this.lyricStyle=Math.floor(5*Math.random())},getLyricFetch:async function(n){const t=await fetch(n);return 0==t.ok?null:await t.text()},getLyric:async function(n){this.lyricContainer.textContent="loading lyric...";var t=await this.getLyricFetch(n+".xrc");null!=t?(this.lyricMode="xrc",this.lyricTranslate=await this.getLyricFetch(n+"_ts.xrc")):(this.lyricMode="lrc",t=await this.getLyricFetch(n+".lrc")),this.lyric=this.parseLyric(t),this.appendLyric(this.lyric)},parseLyricLrc:function(n){for(var t=n.split("\n"),a=/\[\d{2}:\d{2}.\d{2}\]/g,r=[],s=this.getOffset(n);!a.test(t[0]);)t=t.slice(1);return 0==t[t.length-1].length&&t.pop(),t.forEach(function(n,t,o){var e=n.match(a),i=n.replace(a,"");e.forEach(function(n,t,o){n=n.slice(1,-1).split(":");r.push([60*parseInt(n[0],10)+parseFloat(n[1])+parseInt(s)/1e3,i])})}),r.sort(function(n,t){return n[0]-t[0]}),r},parseLyricXrc:function(n){var t=(new DOMParser).parseFromString(n,"text/xml");console.log(t);try{n=t.getElementsByTagName("Lyric_1")[0].getAttribute("LyricContent")}catch(n){console.error(n),alert(".xrc 歌词解析出错.\nfailed to load lyric.")}for(var o=[],e=0;e<n.length;e++)"["==n[e]&&0<e&&(o+="\n"),o+=n[e];if(!(n=o))return null;const i=n,a=i.split("\n").filter(n=>""!==n.trim()),u=[];return a.forEach(n=>{const t=n.match(/\[\s*-?\d+\s*,\s*-?\d+\s*\]/);if(t){const r=t.input.substring(t[0].length),s=[],c=[...r.matchAll(/\(\s*-?\d+\s*,\s*-?\d+\s*\)/g)];for(var o=0;o<c.length;o++){var e=r.substring(0<o?c[o-1].index+c[o-1][0].length:0,c[o].index),i=c[o][0].match(/-?\d+/g),a=parseInt(i[0])/1e3,i=(parseInt(i[0])+parseInt(i[1])-1)/1e3;s.push([e,a,i])}u.push(s)}}),u},parseLyric:function(n){return"lrc"==this.lyricMode?this.parseLyricLrc(n):this.parseLyricXrc(n)},appendLyricLrc:function(a){var n=this.lyricContainer,r=document.createDocumentFragment(),s=(this.lyricContainer.innerHTML="",this);a.forEach(function(n,t,o){var e=document.createElement("p"),i=document.createElement("span");i.id="line-"+t,i.textContent=n[1],i.style.backgroundClip="text",i.style.webkitBackgroundClip="text",1<a.length&&i.addEventListener("click",function(){s.audio.currentTime=n[0],"up"==mouseState&&(document.getElementById("lyricWrapper").scrollTop=i.offsetTop)}),e.appendChild(i),r.appendChild(e)}),n.appendChild(r)},appendLyricXrc:function(n){var t=!1,o=null;if(null!=this.lyricTranslate){t=!0,console.log("Translating lyrics is available.");for(var o=this.parseLyricLrc(this.lyricTranslate),e=0,i=0;e<o.length;e++)"//\r"!=o[e][1]&&"\r"!=o[e][1]&&"//"!=o[e][1]&&""!=o[e][1]&&(o[i++]=o[e]);o.length=i,console.log(o),console.log(n)}var a=this,r=this.lyricContainer,s=document.createDocumentFragment(),c=0;this.lyricContainer.innerHTML="";for(e=0;e<n.length;e++){var u=document.createElement("p"),d=document.createElement("span");d.id="line-"+e,d.setAttribute("start-time",n[e][0][1]),d.setAttribute("word","");for(i=0;i<n[e].length;i++){var l=document.createElement("span");l.style.backgroundClip="text",l.style.webkitBackgroundClip="text",l.id=d.id+"-"+i,l.textContent=n[e][i][0],d.setAttribute("word",d.getAttribute("word")+l.textContent),d.appendChild(l)}d.addEventListener("click",function(){try{if(a.lyric)for(var n=0;n<a.lyric.length;n++){var t=a.lyric[n];document.getElementById("line-"+n).className="";for(var o=0;o<t.length;o++){var e=document.getElementById("line-"+n+"-"+o);e.style.animationName="",e.style.animationDuration="",e.style.animationTimingFunction="",e.className=""}}}catch(n){console.error("ERROR:"+n)}a.audio.currentTime=this.getAttribute("start-time"),a.audio.play(),"up"==mouseState&&(document.getElementById("lyricWrapper").scrollTop=this.offsetTop)}),u.appendChild(d),s.appendChild(u),t&&c<o.length&&Math.abs(n[e][0][1]-o[c][0])<=1&&(u=document.createElement("p"),(d=document.createElement("span")).textContent=o[c++][1],d.classList.add("translateLyric"),d.setAttribute("start-time",n[e][0][1]),d.addEventListener("click",function(){var n,t;a.audio.play(),"up"==mouseState&&(n=document.getElementById("lyricWrapper"),t=this.parentNode.previousSibling.offsetTop,n.scrollTop=t),a.audio.currentTime=this.getAttribute("start-time")}),u.appendChild(d),s.appendChild(u))}r.appendChild(s)},appendLyric:function(n){"lrc"==this.lyricMode?this.appendLyricLrc(n):this.appendLyricXrc(n)},syncLyricLrc:function(){this.lyricContainer.className="";try{if(!this.lyric)return;for(var n=0,t=this.lyric.length;n<=t;n++){if(n==t||this.audio.currentTime<=this.lyric[n][0]-.5){0<n&&n--,1<n&&this.lyric[n][0]==this.lyric[n-1][0]&&n--,(i=document.getElementById("line-"+n)).className="current-line-"+this.lyricStyle,n!=this.last&&(this.last=n,"up"==mouseState&&(document.getElementById("lyricWrapper").scrollTop=i.offsetTop));var o=null,e=this.lyric[n][1];n+1<t&&this.lyric[n][0]==this.lyric[n+1][0]&&(o=this.lyric[n+1][1]),0==e.length&&(e=" "),this.mediaSessionAPI(sessionStorage.getItem("audio_name"),e),pipWindowIsOpened&&pipWindowFill(e,o);for(var i,a=n+1;a<t;a++)(i=document.getElementById("line-"+a)).className="";break}try{(i=document.getElementById("line-"+n)).className=""}catch{console.error("error on #"+n)}}}catch(n){console.error("ERROR:"+n)}},syncLyricXrc:function(){this.lyricContainer.classList.add("current-line-xrc-"+this.lyricStyle);try{if(!this.lyric)return;for(var n=this.audio.currentTime+.25,t=0;t<this.lyric.length;t++){var o=this.lyric[t];if(n<=o[o.length-1][2]+.25){(e=document.getElementById("line-"+t)).classList.add("current-line"),t!=this.last&&("up"==mouseState&&(document.getElementById("lyricWrapper").scrollTop=e.offsetTop),this.last=t),n<o[0][1]?this.mediaSessionAPI(sessionStorage.getItem("audio_name")," "):this.mediaSessionAPI(sessionStorage.getItem("audio_name"),e.getAttribute("word"));for(var e,i=0;i<o.length;i++){var a=document.getElementById("line-"+t+"-"+i);if(!(n>o[i][2])){if(n<o[i][1])break;a.classList.add("current-line-xrc-playing-"+this.lyricStyle),this.lastXrcLetterI==t&&this.lastXrcLetterJ==i||(a.style.animationName="lyric_sync_letter",a.style.animationTimingFunction="linear",a.style.animationDuration=o[i][2]-o[i][1]+"s",this.lastXrcLetterI=t,this.lastXrcLetterJ=i,pipWindowIsOpened&&pipWindowFillXrc(document.getElementById("line-"+this.lastXrcLetterI)));break}a.classList.add("current-line-xrc-played-"+this.lyricStyle),a.classList.remove("current-line-xrc-playing-"+this.lyricStyle)}for(t++;t<this.lyric.length;t++)try{(e=document.getElementById("line-"+t)).className="",document.getElementById("line-"+t).classList.add("current-line-xrc"),e.style="",Array.from(e.getElementsByTagName("span")).forEach(n=>{n.className="",n.style="background-clip: text"})}catch{console.error("error on #"+i)}break}try{(e=document.getElementById("line-"+t)).className="",e.style="",document.getElementById("line-"+t).classList.add("current-line-xrc"),Array.from(e.getElementsByTagName("span")).forEach(n=>{n.className="",n.style="background-clip: text"})}catch{console.error("error on #"+t)}}}catch(n){console.error("ERROR:"+n)}},syncLyric:function(){"lrc"==this.lyricMode?this.syncLyricLrc():this.clickedToSetCurrentTime||this.syncLyricXrc()},ending:function(){this.lyricTranslate?this.lastHasTwoLanguage=!0:this.lastHasTwoLanguage=!1,this.audio.currentTime=0,pipWindowIsOpened&&pipWindowFill(" ",null);var n="order";switch(null!=localStorage.getItem("player_mode")?n=localStorage.getItem("player_mode"):localStorage.setItem("player_mode",n),n){case"order":this.playNext();break;case"reverse":this.playPrev();break;case"random":this.playRandom();break;case"loop":this.playAgain()}},all_played:function(){for(var n=this.playlist.children[0].children,t=0;t<n.length;t++)if("current-song-played"!=n[t].className&&"current-song"!=n[t].className)return!1;return!0},playNum:function(n){var t=this.playlist.children[0].children,o=this.currentIndex;this.currentIndex=n,this.setClass(o,this.currentIndex);n=t[this.currentIndex].children[0].getAttribute("data-name");window.location.hash=n,this.play(n)},playRandom:function(){var n,t=this.playlist.children[0].children,o=this.currentIndex,e=this.all_played();if(e)for(var i=0;i<t.length;i++)t[i].className="";for(;this.currentIndex=Math.floor(Math.random()*this.playlist.children[0].children.length),"current-song-played"==t[this.currentIndex].className||"current-song"==t[this.currentIndex].className;);n=t[this.currentIndex].children[0],this.setClass(e?-1:o,this.currentIndex);e=n.getAttribute("data-name");window.location.hash=e,this.play(e)},playAgain:function(){this.play(window.location.hash.substring(1))},playNext:function(){var n=this.playlist.children[0].children,t=this.currentIndex,t=(this.currentIndex===n.length-1?this.currentIndex=0:this.currentIndex++,n=n[this.currentIndex].children[0],this.setClass(t,this.currentIndex),n.getAttribute("data-name"));window.location.hash=t,this.play(t)},playPrev:function(){var n=this.playlist.children[0].children,t=this.currentIndex,t=(0===this.currentIndex?this.currentIndex=n.length-1:--this.currentIndex,n=n[this.currentIndex].children[0],this.setClass(t,this.currentIndex),n.getAttribute("data-name"));window.location.hash=t,this.play(t)},setClass:function(n,t){var o=this.playlist.children[0].children;-1!=n&&(o[n].className="current-song-played"),o[t].className="current-song"},getOffset:function(n){var t=0;try{var o=n.match(/\[offset:\-?\+?\d+\]/g)[0].split(":")[1],t=parseInt(o)}catch(n){t=0}return t}},document.getElementById("spectrum-cvs")),ctx=cvs.getContext("2d"),audio=document.getElementById("audio");let analyser=null,dataArray=new Uint8Array(512);function initAudio(){let n=new AudioContext,t=n.createMediaElementSource(audio);(analyser=n.createAnalyser()).fftSize=512,dataArray=new Uint8Array(analyser.frequencyBinCount),draw(),t.connect(analyser),analyser.connect(n.destination)}function draw(){requestAnimationFrame(draw),ctx.clearRect(0,0,cvs.width,cvs.height),analyser.getByteFrequencyData(dataArray);var t=cvs.width/3;const o=ctx.createLinearGradient(0,0,cvs.width,0);o.addColorStop(0,"#00ffff"),o.addColorStop(1,"#ff1493");for(let n=0;n<t;n++){var e=dataArray[n]/255*cvs.height;drawRoundedRect(3*n,cvs.height-e,3,e,3),ctx.fillStyle=o,ctx.fill()}}function drawRoundedRect(n,t,o,e,i){ctx.beginPath(),ctx.moveTo(n+i,t),ctx.lineTo(n+o-i,t),ctx.arcTo(n+o,t,n+o,t+e,i),ctx.lineTo(n+o,t+e-i),ctx.arcTo(n+o,t+e,n+o-i,t+e,i),ctx.lineTo(n+i,t+e),ctx.arcTo(n,t+e,n,t+e-i,i),ctx.lineTo(n,t+i),ctx.arcTo(n,t,n+i,t,i),ctx.closePath(),ctx.lineWidth=1,ctx.strokeStyle="#000",ctx.stroke()}initAudio(),document.getElementById("audio").addEventListener("pause",function(){ctx.clearRect(0,0,cvs.width,cvs.height)});